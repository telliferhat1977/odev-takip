<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SinemaTV PRO</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
:root{--red:#E50914;--black:#080808}
body{background:var(--black);color:#fff;margin:0;padding:10px;font-family:sans-serif;overflow:hidden}
.nav-item{cursor:pointer;border-radius:12px;transition:.15s}
.nav-item:focus{outline:none;background:var(--red);transform:scale(1.05)}
.full-modal{display:none!important;position:fixed;inset:0;background:rgba(0,0,0,.97);overflow-y:auto}
.show-modal{display:flex!important}
#results{height:calc(100vh - 170px);overflow-y:auto}
.top-bar{display:flex;gap:8px;margin-bottom:10px}
</style>
</head>

<body onload="loadShowcase()">

<header class="text-center mb-4">
<h1 class="text-3xl font-black italic text-red-600">SinemaTV PRO</h1>
<div class="flex gap-2 mt-3">
<input id="searchInput" placeholder="Film / Dizi / Oyuncu"
 class="flex-1 p-3 bg-[#1a1a1a] rounded-xl nav-item">
<button onclick="searchContent()"
 class="px-6 bg-red-600 rounded-xl font-bold nav-item">ARA</button>
</div>
</header>

<div id="results" class="grid grid-cols-3 gap-4"></div>

<!-- DETAIL -->
<div id="detailPage" class="full-modal flex-col items-center p-6">
<div class="top-bar">
<button onclick="goHome()" class="nav-item px-4 py-2 bg-[#222]">üè†</button>
<button onclick="goBack()" class="nav-item px-4 py-2 bg-[#222]">‚Üê</button>
</div>
<img id="detailPoster" class="max-h-[250px] rounded-xl mb-4">
<h2 id="detailTitle" class="text-2xl font-black mb-3"></h2>
<div id="castList" class="flex flex-wrap gap-2 mb-6"></div>
<button onclick="openSources()" class="bg-red-600 px-8 py-4 rounded-xl font-black nav-item">‚ñ∂ ƒ∞ZLE</button>
</div>

<!-- ACTOR -->
<div id="actorPage" class="full-modal flex-col items-center p-6">
<div class="top-bar">
<button onclick="goHome()" class="nav-item px-4 py-2 bg-[#222]">üè†</button>
<button onclick="goBack()" class="nav-item px-4 py-2 bg-[#222]">‚Üê</button>
</div>
<img id="actorPhoto" class="w-32 h-32 rounded-full mb-3 object-cover">
<h2 id="actorName" class="text-xl font-black mb-2"></h2>
<p id="actorBio" class="text-xs text-gray-400 max-w-xl text-center mb-4"></p>
<div id="actorFilmography" class="grid grid-cols-3 gap-4"></div>
</div>

<script>
const TMDB="847629da5649502fa6655f73b15a5c8e";

/* ================= STATE HISTORY ================= */

let historyStack=[];

function pushState(state){
  historyStack.push(JSON.parse(JSON.stringify(state)));
}

function popState(){
  historyStack.pop();
  const prev=historyStack.at(-1);
  if(prev) restoreState(prev);
}

function goBack(){
  if(historyStack.length>1) popState();
}

function goHome(){
  historyStack=[];
  closeAll();
  loadShowcase();
}

/* ================= COMMON ================= */

function closeAll(){
  detailPage.classList.remove("show-modal");
  actorPage.classList.remove("show-modal");
}

/* ================= HOME ================= */

async function loadShowcase(){
  pushState({view:"home"});
  const r=await fetch(`https://api.themoviedb.org/3/trending/all/day?api_key=${TMDB}&language=tr`);
  displayItems((await r.json()).results);
}

async function searchContent(){
  const q=searchInput.value.trim();
  if(!q) return loadShowcase();
  pushState({view:"search",query:q});
  const r=await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${TMDB}&query=${q}&language=tr`);
  displayItems((await r.json()).results);
}

function displayItems(items){
  closeAll();
  results.innerHTML="";
  items.forEach(i=>{
    if(!i.poster_path) return;
    const type=i.media_type||(i.first_air_date?"tv":"movie");
    const b=document.createElement("button");
    b.className="nav-item";
    b.innerHTML=`<img src="https://image.tmdb.org/t/p/w300${i.poster_path}" class="rounded-lg"><div class="text-[10px] truncate">${i.title||i.name}</div>`;
    b.onclick=()=>openDetails(i.id,type);
    results.appendChild(b);
  });
}

/* ================= DETAIL ================= */

async function openDetails(id,type,fromHistory=false){
  if(!fromHistory) pushState({view:"detail",id,type});
  closeAll();
  const r=await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB}&language=tr&append_to_response=credits`);
  const d=await r.json();
  detailPoster.src=`https://image.tmdb.org/t/p/w500${d.poster_path}`;
  detailTitle.innerText=d.title||d.name;
  castList.innerHTML="";
  d.credits.cast.slice(0,8).forEach(a=>{
    const c=document.createElement("button");
    c.className="nav-item bg-[#222] px-3 py-1 text-xs rounded-full";
    c.innerText=a.name;
    c.onclick=()=>openActor(a.id);
    castList.appendChild(c);
  });
  detailPage.classList.add("show-modal");
}

/* ================= ACTOR ================= */

async function openActor(id,fromHistory=false){
  if(!fromHistory) pushState({view:"actor",id});
  closeAll();
  const r=await fetch(`https://api.themoviedb.org/3/person/${id}?api_key=${TMDB}&language=tr&append_to_response=combined_credits`);
  const d=await r.json();
  actorName.innerText=d.name;
  actorBio.innerText=d.biography||"";
  actorPhoto.src=d.profile_path?`https://image.tmdb.org/t/p/w300${d.profile_path}`:"";
  actorFilmography.innerHTML="";
  d.combined_credits.cast.filter(x=>x.poster_path).forEach(i=>{
    const type=i.media_type==="tv"?"tv":"movie";
    const b=document.createElement("button");
    b.className="nav-item";
    b.innerHTML=`<img src="https://image.tmdb.org/t/p/w300${i.poster_path}" class="rounded-lg"><div class="text-[10px] truncate">${i.title||i.name}</div>`;
    b.onclick=()=>openDetails(i.id,type);
    actorFilmography.appendChild(b);
  });
  actorPage.classList.add("show-modal");
}

/* ================= RESTORE ================= */

function restoreState(s){
  if(s.view==="home") loadShowcase();
  if(s.view==="search"){searchInput.value=s.query;searchContent();}
  if(s.view==="detail") openDetails(s.id,s.type,true);
  if(s.view==="actor") openActor(s.id,true);
}
</script>
</body>
</html>