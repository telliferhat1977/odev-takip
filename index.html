<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ã–dev Takip</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#3498db">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3407/3407024.png">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
:root {
    --primary: #3498db;
    --secondary: #7f8c8d;
    --danger: #e74c3c;
    --success: #2ecc71;
    --bg: #f0f2f5;
}

body {
    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background: var(--bg);
    margin: 0;
    padding: 15px;
    color: #2c3e50;
    -webkit-tap-highlight-color: transparent;
}

h1, h2 { text-align: center; color: #2c3e50; margin: 10px 0; }

.section {
    background: #fff;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 16px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}

/* Modern Input ve Select YapÄ±sÄ± */
input, select {
    width: 100%;
    padding: 14px;
    margin: 8px 0;
    font-size: 16px;
    border: 1px solid #ddd;
    border-radius: 12px;
    box-sizing: border-box;
    background: #fafafa;
}

/* Buton TasarÄ±mlarÄ± */
button {
    width: 100%;
    padding: 15px;
    margin: 10px 0;
    font-size: 16px;
    font-weight: 600;
    border: none;
    border-radius: 12px;
    background: var(--primary);
    color: #fff;
    cursor: pointer;
    transition: transform 0.1s, opacity 0.2s;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 6px rgba(52, 152, 219, 0.2);
}

button:active { transform: scale(0.98); opacity: 0.9; }
button.secondary { background: var(--secondary); box-shadow: 0 4px 6px rgba(127, 140, 141, 0.2); }
button.danger { background: var(--danger); box-shadow: 0 4px 6px rgba(231, 76, 60, 0.2); }

/* Ã–dev Durum ButonlarÄ± (Yan Yana) */
.odev-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
    margin-top: 10px;
}
.odev-grid button { padding: 12px 5px; font-size: 14px; }

.ogrenci {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 10px;
    border-left: 5px solid var(--primary);
}

.row { display: flex; gap: 10px; margin-top: 10px; }
.hidden { display: none; }

hr { border: 0; border-top: 1px solid #eee; margin: 20px 0; }

label { font-weight: bold; font-size: 14px; color: #7f8c8d; }
</style>
</head>
<body>

<div id="karsilamaEkrani" class="section">
<h1>ğŸ« Kurulum</h1>
<input id="okulAd" placeholder="Okul AdÄ±">
<input id="ogretmenAd" placeholder="Ã–ÄŸretmen AdÄ±">
<button id="karsilamaKaydet">ğŸš€ Kurulumu Tamamla</button>
</div>

<div id="mainApp" class="hidden">

<h1 id="okulBaslik" style="font-size: 1.5rem;"></h1>
<h2 id="ogretmenBaslik" style="font-size: 1.1rem; color: var(--secondary);"></h2>

<div class="section">
<h2>ğŸ‘¨â€ğŸ“ Ã–ÄŸrenci KayÄ±t</h2>
<input id="ad" placeholder="Ad Soyad">
<input id="no" placeholder="Okul NumarasÄ±">
<input id="sinif" placeholder="SÄ±nÄ±f (Ã–rn: 9/A)">
<div class="row">
    <button id="kaydetBtn">ğŸ’¾ Kaydet</button>
    <button id="iptalBtn" class="secondary">âœ– Ä°ptal</button>
</div>
<hr>
<input id="arama" placeholder="ğŸ” Ã–ÄŸrenci ara...">
<div id="aramaSonuc"></div>
</div>

<div class="section">
<h2>ğŸ“‹ Ã–dev Kontrol</h2>
<label>Kontrol Tarihi</label>
<input type="date" id="odevTarih">
<select id="odevSinif"><option value="">SÄ±nÄ±f SeÃ§in</option></select>
<select id="odevOgrenciSec" size="5"></select>
<div id="odevIslem"></div>
</div>

<div class="section">
<h2>ğŸ“Š PDF RaporlarÄ±</h2>
<div style="background: #f9f9f9; padding: 10px; border-radius: 12px;">
    <label>GÃ¼nlÃ¼k Rapor</label>
    <select id="raporGunlukSinif"></select>
    <button onclick="gunlukPdf()">ğŸ“„ GÃ¼nlÃ¼k PDF Al</button>
</div>
<div style="background: #f9f9f9; padding: 10px; border-radius: 12px; margin-top: 15px;">
    <label>AylÄ±k Rapor</label>
    <select id="raporAylikSinif"></select>
    <input type="month" id="raporAy">
    <button onclick="aylikPdf()" class="secondary">ğŸ“… AylÄ±k PDF Al</button>
</div>
</div>

<div class="section">
<h2>ğŸ’¾ Veri YÃ¶netimi</h2>
<button onclick="jsonYedekAl()">â¬‡ï¸ Yedek Ä°ndir (JSON)</button>
<label>Yedek YÃ¼kle</label>
<input type="file" id="jsonFile" accept="application/json">
<button class="secondary" onclick="jsonYukle()">â¬†ï¸ Verileri Geri YÃ¼kle</button>
</div>

<script>
// (Ã–nceki mantÄ±k kodlarÄ±nÄ±n tamamÄ± buraya gelecek - Tarih kÄ±sÄ±tlamasÄ± dahil)
let okulAd = localStorage.getItem('okulAd') || '';
let ogretmenAd = localStorage.getItem('ogretmenAd') || '';
let ogrenciler = JSON.parse(localStorage.getItem('ogrenciler')) || [];
let odevler = JSON.parse(localStorage.getItem('odevler')) || [];
let seciliNo = null;

const karsilamaEkrani = document.getElementById('karsilamaEkrani');
const mainApp = document.getElementById('mainApp');
const okulBaslik = document.getElementById('okulBaslik');
const ogretmenBaslik = document.getElementById('ogretmenBaslik');
const okulInput = document.getElementById('okulAd');
const ogretmenInput = document.getElementById('ogretmenAd');
const karsilamaKaydetBtn = document.getElementById('karsilamaKaydet');

function karsilamaGoster(){
 if(okulAd && ogretmenAd){
  okulBaslik.textContent = `ğŸ« ${okulAd}`;
  ogretmenBaslik.textContent = `ğŸ‘©â€ğŸ« ${ogretmenAd}`;
  karsilamaEkrani.classList.add('hidden');
  mainApp.classList.remove('hidden');
 } else {
  karsilamaEkrani.classList.remove('hidden');
  mainApp.classList.add('hidden');
 }
}
karsilamaGoster();

karsilamaKaydetBtn.onclick = ()=>{
 okulAd = okulInput.value.trim();
 ogretmenAd = ogretmenInput.value.trim();
 if(!okulAd || !ogretmenAd){alert('Her iki alanÄ± doldurun'); return;}
 localStorage.setItem('okulAd',okulAd);
 localStorage.setItem('ogretmenAd',ogretmenAd);
 karsilamaGoster();
};

const adInp = document.getElementById('ad');
const noInp = document.getElementById('no');
const sinifInp = document.getElementById('sinif');
const kaydetBtn = document.getElementById('kaydetBtn');
const iptalBtn = document.getElementById('iptalBtn');
const aramaInp = document.getElementById('arama');
const sonucDiv = document.getElementById('aramaSonuc');
const odevSinif = document.getElementById('odevSinif');
const odevOgrenciSec = document.getElementById('odevOgrenciSec');
const odevTarih = document.getElementById('odevTarih');
const raporGunlukSinif = document.getElementById('raporGunlukSinif');
const raporAylikSinif = document.getElementById('raporAylikSinif');

const bugunISO = new Date().toISOString().split('T')[0];
odevTarih.value = bugunISO;
odevTarih.setAttribute('max', bugunISO);

function kaydet(){
 const ad = adInp.value.trim();
 const no = noInp.value.trim();
 const sinif = sinifInp.value.trim();
 if(!ad||!no||!sinif){alert('TÃ¼m alanlarÄ± doldurun');return;}
 if(seciliNo){
  const o = ogrenciler.find(x=>x.no===seciliNo);
  o.ad=ad; o.no=no; o.sinif=sinif;
  seciliNo=null; kaydetBtn.innerHTML='ğŸ’¾ Kaydet';
 } else {
  if(ogrenciler.some(x=>x.no===no)){alert('Numara zaten var');return;}
  ogrenciler.push({ad,no,sinif});
 }
 localStorage.setItem('ogrenciler',JSON.stringify(ogrenciler));
 temizle(); siniflariDoldur(); alert('BaÅŸarÄ±yla kaydedildi.');
}

function temizle(){adInp.value=noInp.value=sinifInp.value='';}
function iptal(){temizle();seciliNo=null;kaydetBtn.innerHTML='ğŸ’¾ Kaydet';}

function arama(){
 const q = aramaInp.value.toLowerCase(); sonucDiv.innerHTML='';
 if(!q) return;
 ogrenciler.filter(o=>o.ad.toLowerCase().includes(q)||o.no.includes(q)).forEach(o=>{
  const d=document.createElement('div'); d.className='ogrenci';
  d.innerHTML=`<b>${o.ad}</b><br>No: ${o.no} | SÄ±nÄ±f: ${o.sinif}
  <div class='row'>
   <button onclick="duzenle('${o.no}')">Kalem DÃ¼zenle</button>
   <button class='danger' onclick="sil('${o.no}')">Ã‡Ã¶p Sil</button>
  </div>`;
  sonucDiv.appendChild(d);
 });
}

function duzenle(no){
 const o=ogrenciler.find(x=>x.no===no);
 adInp.value=o.ad; noInp.value=o.no; sinifInp.value=o.sinif;
 seciliNo=no; kaydetBtn.innerHTML='ğŸ”„ GÃ¼ncelle';
 window.scrollTo(0,0);
}

function sil(no){
 if(!confirm('Ã–ÄŸrenciyi silmek istediÄŸinize emin misiniz?')) return;
 ogrenciler=ogrenciler.filter(x=>x.no!==no);
 odevler=odevler.filter(x=>x.no!==no);
 localStorage.setItem('ogrenciler',JSON.stringify(ogrenciler));
 localStorage.setItem('odevler',JSON.stringify(odevler));
 siniflariDoldur(); sonucDiv.innerHTML='';
}

function siniflariDoldur(){
 odevSinif.innerHTML='<option value="">SÄ±nÄ±f SeÃ§</option>';
 raporGunlukSinif.innerHTML='<option value="">SÄ±nÄ±f SeÃ§</option>';
 raporAylikSinif.innerHTML='<option value="">SÄ±nÄ±f SeÃ§</option>';
 const siniflar=[...new Set(ogrenciler.map(o=>o.sinif.trim().toUpperCase()))];
 siniflar.forEach(s=>{
   const opt=document.createElement('option');opt.value=s;opt.textContent=s;odevSinif.appendChild(opt);
   const optG=document.createElement('option');optG.value=s;optG.textContent=s;raporGunlukSinif.appendChild(optG);
   const optA=document.createElement('option');optA.value=s;optA.textContent=s;raporAylikSinif.appendChild(optA);
 });
}

odevSinif.onchange=()=>{
 odevOgrenciSec.innerHTML='';
 ogrenciler.filter(o=>o.sinif.toUpperCase()===odevSinif.value)
 .forEach(o=>{
   const opt=document.createElement('option');
   opt.value=o.no;
   opt.textContent=`${o.ad} (${o.no})`;
   odevOgrenciSec.appendChild(opt);
 });
};

odevOgrenciSec.onchange=()=>{
 const no=odevOgrenciSec.value;
 const div=document.getElementById('odevIslem');
 div.innerHTML=`<div class="odev-grid">
                  <button onclick="odevKaydet('${no}','yapti')" style="background:var(--success)">âœ… YaptÄ±</button>
                  <button onclick="odevKaydet('${no}','yapmadi')" class="danger">âŒ YapmadÄ±</button>
                  <button onclick="odevKaydet('${no}','gelmedi')" class="secondary">ğŸš« Gelmedi</button>
                </div>`;
};

function odevKaydet(no,durum){
 const tarih=odevTarih.value;
 if(tarih > bugunISO) { alert("Gelecek tarihe iÅŸlem yapÄ±lamaz!"); return; }
 const i=odevler.findIndex(o=>o.no===no&&o.tarih===tarih);
 if(i>-1) odevler[i].durum=durum; else odevler.push({no,tarih,durum});
 localStorage.setItem('odevler',JSON.stringify(odevler));
 // Bir sonraki Ã¶ÄŸrenciye odaklanmayÄ± kolaylaÅŸtÄ±rmak iÃ§in kÃ¼Ã§Ã¼k bir gÃ¶rsel bildirim
 const btn = event.target;
 const originalText = btn.innerHTML;
 btn.innerHTML = "TAMAM";
 setTimeout(()=> { btn.innerHTML = originalText; }, 1000);
}

function formatTarih(tarihStr) {
  const [y, a, g] = tarihStr.split('-');
  return `${g}/${a}/${y.substring(2)}`;
}

function gunlukPdf(){
 const bugun = new Date().toISOString().split('T')[0];
 const seciliSinif = raporGunlukSinif.value;
 if(!seciliSinif){alert('LÃ¼tfen sÄ±nÄ±f seÃ§in');return;}
 const { jsPDF } = window.jspdf;
 const doc = new jsPDF();
 const liste = ogrenciler.filter(o=>o.sinif.toUpperCase()===seciliSinif.toUpperCase());
 const baslik = `${seciliSinif} - GÃ¼nlÃ¼k Ã–dev Raporu - ${formatTarih(bugun)}`;
 doc.setFontSize(14); doc.text(baslik, 14, 14);
 const rows = liste.map(o=>{
   const ov = odevler.find(d=>d.no===o.no && d.tarih===bugun);
   return [o.no,o.ad, ov? (ov.durum==='yapti'?'YaptÄ±':ov.durum==='yapmadi'?'YapmadÄ±':'Gelmedi'):'Girilmedi'];
 });
 doc.autoTable({ head:[['No','Ad Soyad','Durum']], body:rows, startY:20 });
 doc.save(`gunluk_${seciliSinif}.pdf`);
}

function aylikPdf(){
 const ay=document.getElementById('raporAy').value;
 const seciliSinif=raporAylikSinif.value;
 if(!ay || !seciliSinif){alert('SÄ±nÄ±f ve ay seÃ§in');return;}
 const { jsPDF } = window.jspdf;
 const doc=new jsPDF(); 
 const sinifOgrencileri = ogrenciler.filter(o=>o.sinif.toUpperCase()===seciliSinif.toUpperCase());
 const sinifNolari = sinifOgrencileri.map(o => o.no);
 const sinifTarihleri = [...new Set(odevler.filter(o => sinifNolari.includes(o.no) && o.tarih.startsWith(ay)).map(o => o.tarih))].sort();
 if(sinifTarihleri.length === 0) { alert('Veri bulunamadÄ±'); return; }
 doc.setFontSize(14); doc.text(`${seciliSinif} - AylÄ±k Rapor (${ay})`, 14, 14);
 const head = ['No','Ad Soyad',...sinifTarihleri.map(t=>formatTarih(t))];
 const rows = sinifOgrencileri.map(o=>{
   const row=[o.no,o.ad];
   sinifTarihleri.forEach(t=>{
     const ov = odevler.find(d=>d.no===o.no && d.tarih===t);
     row.push(ov? (ov.durum==='yapti'?'YaptÄ±':ov.durum==='yapmadi'?'YapmadÄ±':'Gelmedi'):'-');
   });
   return row;
 });
 doc.autoTable({ head:[head], body:rows, startY:20, styles:{fontSize:7} });
 doc.save(`aylik_${seciliSinif}.pdf`);
}

function jsonYedekAl(){
 const blob=new Blob([JSON.stringify({ogrenciler,odevler},null,2)],{type:'application/json'});
 const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='odev_yedek.json';a.click();
}

function jsonYukle(){
 const f=document.getElementById('jsonFile').files[0]; if(!f) return;
 const r=new FileReader(); r.onload=e=>{
  const d=JSON.parse(e.target.result);
  localStorage.setItem('ogrenciler',JSON.stringify(d.ogrenciler));
  localStorage.setItem('odevler',JSON.stringify(d.odevler));
  location.reload();
 };
 r.readAsText(f);
}

kaydetBtn.addEventListener('click',kaydet);
iptalBtn.addEventListener('click',iptal);
aramaInp.addEventListener('input',arama);
siniflariDoldur();
</script>
</body>
</html>
