<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Telefon Uyumlu Ã–dev Takip</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#3498db">
<style>
body{font-family:Arial,sans-serif;background:#f4f6f8;margin:0;padding:10px}
h1,h2{text-align:center}
.section{background:#fff;padding:15px;margin-bottom:15px;border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,.1)}
input,select,button{width:100%;padding:14px;margin-top:6px;margin-bottom:12px;font-size:1rem}
button{border:none;border-radius:10px;background:#3498db;color:#fff}
button.secondary{background:#7f8c8d}
button.danger{background:#e74c3c}
.ogrenci{background:#ecf0f1;padding:10px;border-radius:10px;margin-bottom:8px}
.row{display:flex;gap:8px;margin-top:8px}
.row button{flex:1}
.gecmis{font-size:0.9rem;margin-top:6px}
</style>
</head>
<body>

<h1>ğŸ“˜ Ã–dev Takip Sistemi</h1>
<p id="baslik" style="text-align:center;font-weight:bold"></p>

<div class="section">
<h2>ğŸ« Okul / Ã–ÄŸretmen Bilgisi</h2>
<input id="okulAdi" placeholder="Okul AdÄ±">
<input id="ogretmenAdi" placeholder="Ã–ÄŸretmen AdÄ±">
<button onclick="bilgiKaydet()">ğŸ’¾ Kaydet</button>
</div>

<div class="section">
<h2>ğŸ‘¨â€ğŸ“ Ã–ÄŸrenci YÃ¶netimi</h2>
<input id="arama" placeholder="ğŸ” Ã–ÄŸrenci adÄ± veya numara ile ara">
<input id="ad" placeholder="Ad Soyad">
<input id="no" placeholder="Numara">
<input id="sinif" placeholder="SÄ±nÄ±f">
<button id="kaydetBtn">Kaydet</button>
<button class="secondary" id="iptalBtn">Ä°ptal</button>
<div id="aramaSonuc"></div>
</div>

<div class="section">
<h2>ğŸ“‹ Ã–dev Kontrol (Tarihli)</h2>
<input type="date" id="odevTarih">
<select id="odevSinif"></select>
<div id="odevOgrenciListesi"></div>
</div>

<div class="section">
<h2>ğŸ“œ Ã–ÄŸrenci Ã–dev GeÃ§miÅŸi</h2>
<select id="gecmisOgrenci"></select>
<div id="gecmisListe"></div>
</div>

<div class="section">
<h2>ğŸ“Š AylÄ±k PDF Rapor</h2>
<input type="month" id="raporAy">
<button onclick="aylikPdf()">ğŸ“„ PDF Ã–nizleme</button>
<button class="secondary" onclick="pdfIndir()">â¬‡ï¸ Tek TÄ±k PDF Ä°ndir</button>
</div>

<div class="section">
<h2>ğŸ’¾ Yedekleme</h2>
<button onclick="yedekAl()">ğŸ“¦ JSON Yedek Al</button>
<button class="secondary" onclick="yedekBirlesikYukle()">ğŸ” YedeÄŸi BirleÅŸtir</button>
<button class="secondary" onclick="sifreKaydet()">ğŸ”’ Ã–ÄŸretmen Åifresi</button>
</div>

<script>
// ===== VERÄ°LER =====
let ogrenciler = JSON.parse(localStorage.getItem('ogrenciler')) || [];
let odevler = JSON.parse(localStorage.getItem('odevler')) || [];
let seciliNo = null;
let okulBilgi = JSON.parse(localStorage.getItem('okulBilgi')) || {okul:'', ogretmen:''};

// ===== ELEMENTLER =====
const adInp=ad,noInp=no,sinifInp=sinif;
const aramaInp=document.getElementById('arama');
const sonucDiv=document.getElementById('aramaSonuc');
const kaydetBtn=document.getElementById('kaydetBtn');
const iptalBtn=document.getElementById('iptalBtn');
const odevSinif=document.getElementById('odevSinif');
const odevListe=document.getElementById('odevOgrenciListesi');
const odevTarih=document.getElementById('odevTarih');
const gecmisOgrenci=document.getElementById('gecmisOgrenci');
const gecmisListe=document.getElementById('gecmisListe');

odevTarih.value = new Date().toISOString().split('T')[0];

kaydetBtn.onclick=kaydet;
aramaInp.oninput=aramaYap;
iptalBtn.onclick=iptal;
odevSinif.onchange=odevSinifDegisti;
gecmisOgrenci.onchange=gecmisGoster;

bilgiGoster();

function bilgiKaydet(){
 okulBilgi.okul = document.getElementById('okulAdi').value.trim();
 okulBilgi.ogretmen = document.getElementById('ogretmenAdi').value.trim();
 localStorage.setItem('okulBilgi', JSON.stringify(okulBilgi));
 bilgiGoster();
 alert('Bilgiler kaydedildi');
}

function bilgiGoster(){
 document.getElementById('okulAdi').value = okulBilgi.okul;
 document.getElementById('ogretmenAdi').value = okulBilgi.ogretmen;
 const b = document.getElementById('baslik');
 b.textContent = [okulBilgi.okul, okulBilgi.ogretmen].filter(Boolean).join(' â€“ ');
}

// ===== Ã–ÄRENCÄ° =====
function kaydet(){
 const ad=adInp.value.trim(), no=noInp.value.trim(), sinif=sinifInp.value.trim();
 if(!ad||!no||!sinif) return alert('TÃ¼m alanlarÄ± doldurun');

 if(seciliNo){
  if(!confirm('GÃ¼ncellensin mi?')) return;
  const o=ogrenciler.find(x=>x.no===seciliNo);
  if(!o) return alert('Ã–ÄŸrenci bulunamadÄ±');
  o.ad=ad; o.no=no; o.sinif=sinif;
  seciliNo=null;
  kaydetBtn.textContent='Kaydet';
 }else{
  if(ogrenciler.some(x=>x.no===no)) return alert('Bu numara zaten var');
  ogrenciler.push({ad,no,sinif});
 }

 localStorage.setItem('ogrenciler', JSON.stringify(ogrenciler));
 temizle();
 aramaInp.value='';
 sonucDiv.innerHTML='';
 siniflariDoldur();
 ogrenciDropdown();
 alert('âœ… Kaydedildi');
}
 else{ if(ogrenciler.some(x=>x.no===no)) return alert('Bu numara var'); ogrenciler.push({ad,no,sinif}); }
 localStorage.setItem('ogrenciler',JSON.stringify(ogrenciler)); temizle(); aramaYap(); siniflariDoldur(); ogrenciDropdown(); }

function duzenle(no){ const o=ogrenciler.find(x=>x.no===no); adInp.value=o.ad; noInp.value=o.no; sinifInp.value=o.sinif; seciliNo=no; kaydetBtn.textContent='GÃ¼ncelle'; }
function sil(no){ const o=ogrenciler.find(x=>x.no===no); if(!confirm(o.ad+' silinsin mi?'))return; ogrenciler=ogrenciler.filter(x=>x.no!==no); odevler=odevler.filter(x=>x.no!==no); localStorage.setItem('ogrenciler',JSON.stringify(ogrenciler)); localStorage.setItem('odevler',JSON.stringify(odevler)); aramaYap(); siniflariDoldur(); ogrenciDropdown(); }
function aramaYap(){
 const q = aramaInp.value.trim().toLowerCase();
 sonucDiv.innerHTML='';
 if(q.length<2) return;
 const o = ogrenciler.find(x=>x.ad.toLowerCase().includes(q) || x.no.includes(q));
 if(!o){ sonucDiv.innerHTML='<p>Ã–ÄŸrenci bulunamadÄ±</p>'; return; }
 const d=document.createElement('div'); d.className='ogrenci';
 d.innerHTML=`<b>${o.ad}</b><br>No:${o.no} | ${o.sinif}
 <div class='row'>
 <button onclick="duzenle('${o.no}')">âœï¸ GÃ¼ncelle</button>
 <button class='danger' onclick="sil('${o.no}')">ğŸ—‘ï¸ Sil</button>
 </div>`;
 sonucDiv.appendChild(d);
}

function listele(){}{ listeDiv.innerHTML=''; ogrenciler.forEach(o=>{ const d=document.createElement('div'); d.className='ogrenci'; d.innerHTML=`<b>${o.ad}</b><br>No:${o.no} | ${o.sinif}<div class='row'><button onclick="duzenle('${o.no}')">âœï¸</button><button class='danger' onclick="sil('${o.no}')">ğŸ—‘ï¸</button></div>`; listeDiv.appendChild(d); }); }
function temizle(){ adInp.value=noInp.value=sinifInp.value=''; }
function iptal(){
 temizle();
 seciliNo=null;
 kaydetBtn.textContent='Kaydet';
 aramaInp.value='';
 sonucDiv.innerHTML='';
}{ temizle(); seciliNo=null; kaydetBtn.textContent='Kaydet'; }

// ===== Ã–DEV =====
function siniflariDoldur(){
 odevSinif.innerHTML='<option value="">SÄ±nÄ±f SeÃ§</option>';
 const siniflar = [...new Set(ogrenciler.map(o=>o.sinif))];
 siniflar.forEach(s=>{
  const opt=document.createElement('option');
  opt.value=s; opt.textContent=s;
  odevSinif.appendChild(opt);
 });
}</option>`); }

function odevSinifDegisti(){ const sinif=odevSinif.value; odevListe.innerHTML=''; ogrenciler.filter(o=>o.sinif===sinif).forEach(o=>{ const d=document.createElement('div'); d.className='ogrenci'; d.innerHTML=`<b>${o.ad}</b><div class='row'><button onclick="odevKaydet('${o.no}',true)">âœ…</button><button class='danger' onclick="odevKaydet('${o.no}',false)">âŒ</button></div>`; odevListe.appendChild(d); }); }

function odevKaydet(no,yapti){ const tarih=odevTarih.value; const i=odevler.findIndex(o=>o.no===no && o.tarih===tarih); if(i>-1) odevler[i].yapti=yapti; else odevler.push({no,tarih,yapti}); localStorage.setItem('odevler',JSON.stringify(odevler)); }

// ===== GEÃ‡MÄ°Å =====
function ogrenciDropdown(){ gecmisOgrenci.innerHTML='<option value="">Ã–ÄŸrenci SeÃ§</option>'; ogrenciler.forEach(o=>gecmisOgrenci.innerHTML+=`<option value="${o.no}">${o.ad} (${o.sinif})</option>`); }
function gecmisGoster(){ const no=gecmisOgrenci.value; gecmisListe.innerHTML=''; odevler.filter(o=>o.no===no).sort((a,b)=>b.tarih.localeCompare(a.tarih)).forEach(o=>{ const d=document.createElement('div'); d.className='ogrenci gecmis'; d.textContent=`${o.tarih} â†’ ${o.yapti?'YaptÄ±':'YapmadÄ±'}`; gecmisListe.appendChild(d); }); }

// ===== ÅÄ°FRE =====
let sifre = localStorage.getItem('ogretmenSifre') || '';
if(sifre && !sessionStorage.getItem('giris')){
 const g = prompt('Ã–ÄŸretmen Åifresi');
 if(g !== sifre){ alert('HatalÄ± ÅŸifre'); document.body.innerHTML=''; }
 else sessionStorage.setItem('giris','ok');
}

function sifreKaydet(){
 const s = prompt('Yeni ÅŸifre gir');
 if(!s) return;
 localStorage.setItem('ogretmenSifre', s);
 alert('Åifre kaydedildi');
}

// ===== YEDEK =====
function yedekAl(){
 const veri={ogrenciler,odevler};
 const blob=new Blob([JSON.stringify(veri,null,2)],{type:'application/json'});
 const a=document.createElement('a');
 a.href=URL.createObjectURL(blob);
 a.download='odev_yedek_'+new Date().toISOString().split('T')[0]+'.json';
 a.click();
}

function yedekBirlesikYukle(){
 if(!confirm('Mevcut veriler KORUNACAK ve yedekle BÄ°RLEÅTÄ°RÄ°LECEK. Devam edilsin mi?')) return;
 const input=document.createElement('input');
 input.type='file';
 input.accept='.json';
 input.onchange=e=>{
  const file=e.target.files[0]; if(!file) return;
  const r=new FileReader();
  r.onload=()=>{
   try{
    const d=JSON.parse(r.result);
    if(!Array.isArray(d.ogrenciler)||!Array.isArray(d.odevler)) return alert('GeÃ§ersiz yedek');

    d.ogrenciler.forEach(o=>{ if(!ogrenciler.some(x=>x.no===o.no)) ogrenciler.push(o); });
    d.odevler.forEach(o=>{ if(!odevler.some(x=>x.no===o.no && x.tarih===o.tarih)) odevler.push(o); });

    localStorage.setItem('ogrenciler',JSON.stringify(ogrenciler));
    localStorage.setItem('odevler',JSON.stringify(odevler));

    aramaYap(); siniflariDoldur(); ogrenciDropdown();
    alert('âœ… Yedek baÅŸarÄ±yla birleÅŸtirildi');
   }catch{ alert('Dosya okunamadÄ±'); }
  };
  r.readAsText(file);
 };
 input.click();
}

// ===== PDF =====
function aylikPdf(){
 const ay=raporAy.value; if(!ay) return alert('Ay seÃ§');
 let sinifOzet={};
 odevler.filter(o=>o.tarih.startsWith(ay)).forEach(o=>{
  const ogr=ogrenciler.find(x=>x.no===o.no); if(!ogr) return;
  if(!sinifOzet[ogr.sinif]) sinifOzet[ogr.sinif]={yapti:0,yapmadi:0};
  o.yapti ? sinifOzet[ogr.sinif].yapti++ : sinifOzet[ogr.sinif].yapmadi++;
 });
 const baslik=`${okulBilgi.okul||''} ${okulBilgi.ogretmen||''}`;
 let html=`<h2>${baslik}</h2><h3>AylÄ±k Ã–dev Raporu (${ay})</h3>`;
 html+='<h4>SÄ±nÄ±f BazlÄ± Ã–zet</h4><table border=1 width=100%><tr><th>SÄ±nÄ±f</th><th>YaptÄ±</th><th>YapmadÄ±</th></tr>';
 Object.keys(sinifOzet).forEach(s=>{html+=`<tr><td>${s}</td><td>${sinifOzet[s].yapti}</td><td>${sinifOzet[s].yapmadi}</td></tr>`});
 html+='</table><br>';
 html+='<table border=1 width=100%><tr><th>SÄ±nÄ±f</th><th>Ã–ÄŸrenci</th><th>No</th><th>Tarih</th><th>Durum</th></tr>';
 odevler.filter(o=>o.tarih.startsWith(ay)).forEach(o=>{
  const ogr=ogrenciler.find(x=>x.no===o.no); if(!ogr) return;
  html+=`<tr><td>${ogr.sinif}</td><td>${ogr.ad}</td><td>${ogr.no}</td><td>${o.tarih}</td><td>${o.yapti?'YaptÄ±':'YapmadÄ±'}</td></tr>`;
 });
 html+='</table>';
 const w=window.open('','_blank'); w.document.write(html); w.document.close();
}

function pdfIndir(){
 const ay=raporAy.value; if(!ay) return alert('Ay seÃ§');
 aylikPdf(); setTimeout(()=>window.print(),500);
}

// ===== INIT =====
aramaYap(); siniflariDoldur(); ogrenciDropdown();
</script>
</body>
</html>
