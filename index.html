<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ödev Takip Sistemi</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
*{box-sizing:border-box}
body{font-family:Arial,Helvetica,sans-serif;background:#f2f4f7;margin:0;padding:8px}
h2,h3{text-align:center;margin:6px 0}
.section{background:#fff;padding:12px;margin-bottom:12px;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
input,select,button{width:100%;padding:12px;margin:6px 0;font-size:1rem;border-radius:10px;border:1px solid #ccc}
button{border:none;background:#3498db;color:#fff;font-weight:bold}
.row{display:flex;gap:8px}
.row button{flex:1}
.ogrenci{background:#eef1f4;padding:10px;border-radius:10px;margin-bottom:6px;cursor:pointer}
#baslikEkran{position:sticky;top:0;background:#3498db;color:#fff;padding:8px;border-radius:0 0 14px 14px}
</style>
</head>
<body>

<div id="baslikEkran" style="display:none">
<h3 id="okulAdi"></h3>
<small id="ogretmenAdi"></small>
</div>

<div id="ilkAcilis" class="section">
<h3>Okul ve Öğretmen Bilgileri</h3>
<input id="okulInput" placeholder="Okul Adı">
<input id="ogretmenInput" placeholder="Öğretmen Adı">
<button id="ilkKaydetBtn">Kaydet</button>
</div>

<div id="anaEkran" style="display:none">

<div class="section">
<h3>Öğrenci Yönetimi</h3>
<input id="ad" placeholder="Ad Soyad">
<input id="no" placeholder="Numara">
<input id="sinif" placeholder="Sınıf (9/C)">
<button onclick="ogrenciKaydet()">Kaydet / Güncelle</button>
<input id="arama" placeholder="Ara (ad / no)">
<div id="aramaSonuc"></div>
</div>

<div class="section">
<h3>Ödev Kontrol</h3>
<input type="date" id="odevTarih">
<select id="odevSinif"></select>
<select id="odevOgrenci" size="6"></select>
<div id="odevButon"></div>
</div>

<div class="section">
<h3>PDF</h3>
<button onclick="gunlukPdf()">Günlük PDF</button>
<input type="month" id="raporAy">
<button onclick="aylikPdf()">Aylık PDF</button>
</div>

</div>

<script>
/******** FONT ********/
const DEJAVU_BASE64="AAEAAAALAIAAAwAwT1MvMg8SBJkAAAC8AAAAYGNtYXAa8xXhAAABHAAAAFRnYXNwAAAAEAAAAXgAAAAIZ2x5Zg8e5l4AAAF8AAABmGhlYWQY1+JmAAACyAAAADZoaGVhB6kE0gAAANgAAAAkaG10eBYAAB8AAAD8AAAALGxvY2ED5gJCAAABRAAAABxtYXhwAAgAKwAAAUgAAAAgbmFtZb0Fq5MAAAF4AAABznBvc3QAAwAAAAAEoAAAACAAAwPpAZAABQAAAUwAAAAgAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAD//wADAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAQ==";

let ogrenciler=JSON.parse(localStorage.getItem('ogrenciler'))||[];
let odevler=JSON.parse(localStorage.getItem('odevler'))||[];
let okulAdi=localStorage.getItem('okulAdi')||"";
let ogretmenAdi=localStorage.getItem('ogretmenAdi')||"";
let seciliNo=null;

const today=new Date().toISOString().split('T')[0];
odevTarih.max=today;
odevTarih.value=today;
// Aylık rapor için varsayılan ay
raporAy.value = today.slice(0,7);

if(okulAdi){ilkAcilis.style.display='none';anaEkran.style.display='block';baslik();}

ilkKaydetBtn.onclick=()=>{
 okulAdi=okulInput.value;ogretmenAdi=ogretmenInput.value;
 localStorage.setItem('okulAdi',okulAdi);
 localStorage.setItem('ogretmenAdi',ogretmenAdi);
 ilkAcilis.style.display='none';anaEkran.style.display='block';baslik();
}

function baslik(){
 document.getElementById('baslikEkran').style.display='block';
 okulAdi&&(document.getElementById('okulAdi').textContent=okulAdi);
 ogretmenAdi&&(document.getElementById('ogretmenAdi').textContent=ogretmenAdi);
}

function ogrenciKaydet(){
 if(!ad.value||!no.value||!sinif.value)return alert('Eksik bilgi');
 ogrenciler=ogrenciler.filter(o=>o.no!==no.value);
 ogrenciler.push({ad:ad.value,no:no.value,sinif:sinif.value});
 localStorage.setItem('ogrenciler',JSON.stringify(ogrenciler));
 siniflariYukle(); alert('Kaydedildi');
}

arama.oninput=()=>{
 aramaSonuc.innerHTML='';
 const q=arama.value.toLowerCase();
 ogrenciler.filter(o=>o.ad.toLowerCase().includes(q)||o.no.includes(q))
 .forEach(o=>{
  const d=document.createElement('div');d.className='ogrenci';
  d.textContent=`${o.ad} (${o.no})`;
  d.onclick=()=>{ad.value=o.ad;no.value=o.no;sinif.value=o.sinif;seciliNo=o.no};
  aramaSonuc.appendChild(d);
 });
}

function siniflariYukle(){
 odevSinif.innerHTML='<option value="">Sınıf Seç</option>';
 [...new Set(ogrenciler.map(o=>o.sinif))].forEach(s=>{
  const op=document.createElement('option');op.value=s;op.textContent=s;odevSinif.appendChild(op);
 });
}

odevSinif.onchange=()=>{
 odevOgrenci.innerHTML='';
 ogrenciler.filter(o=>o.sinif===odevSinif.value).forEach(o=>{
  const op=document.createElement('option');op.value=o.no;op.textContent=`${o.ad} (${o.no})`;odevOgrenci.appendChild(op);
 });
}

odevOgrenci.onchange=()=>{
 odevButon.innerHTML='';
 ['yapti','yapmadi','gelmedi'].forEach(d=>{
  const b=document.createElement('button');
  b.textContent=d==='yapti'?'Yaptı':d==='yapmadi'?'Yapmadı':'Gelmedi';
  b.onclick=()=>{
   odevler=odevler.filter(o=>!(o.no===odevOgrenci.value&&o.tarih===odevTarih.value));
   odevler.push({no:odevOgrenci.value,tarih:odevTarih.value,durum:d});
   localStorage.setItem('odevler',JSON.stringify(odevler));
   alert('Kaydedildi');
  };
  odevButon.appendChild(b);
 });
}

function pdfBase(o='p'){
 const {jsPDF}=window.jspdf;const d=new jsPDF({orientation:o});
 d.addFileToVFS('DejaVuSans.ttf',DEJAVU_BASE64);
 d.addFont('DejaVuSans.ttf','DejaVu','normal');
 d.setFont('DejaVu');return d;
}

function renk(d){return d==='yapti'?[46,204,113]:d==='yapmadi'?[231,76,60]:d==='gelmedi'?[241,196,15]:null}

function gunlukPdf(){
 const doc=pdfBase();let y=34;
 const tarih=odevTarih.value;
 const sinifSec=odevSinif.value||null;
 const ogrList= sinifSec ? ogrenciler.filter(o=>o.sinif===sinifSec) : ogrenciler;
 const kayitVar = ogrList.some(o=>odevler.some(x=>x.no===o.no && x.tarih===tarih));
 if(!kayitVar){ alert('Bu tarih için kayıt bulunamadı'); return; }

 doc.text(`${okulAdi} - ${ogretmenAdi}`,10,10);
 doc.text(`${sinifSec?sinifSec+' - ':''}Günlük Ödev Raporu (${tarih})`,10,18);
 // Başlık arka planı
 doc.setFillColor(220,230,241); doc.rect(8,22,194,10,'F');
 doc.setTextColor(0,0,0);
 doc.text('No',10,29); doc.text('Ad Soyad',30,29); doc.text('Durum',160,29);
 y=40;
 ogrList.forEach(o=>{
  const r=odevler.find(x=>x.no===o.no&&x.tarih===tarih);
  if(!r) return;
  const d=r.durum; const c=renk(d);
  if(c){doc.setFillColor(...c); doc.rect(155,y-6,40,8,'F');}
  doc.setTextColor(0,0,0);
  doc.text(o.no,10,y); doc.text(o.ad,30,y);
  doc.text(d==='yapti'?'Yaptı':d==='yapmadi'?'Yapmadı':'Gelmedi',160,y);
  y+=8;
 });
 doc.save(`gunluk_${sinifSec?sinifSec+'_':''}${tarih}.pdf`);
}

function aylikPdf(){
 const ay=raporAy.value; const doc=pdfBase('l'); let y=36;
 const sinifSec=odevSinif.value||null;
 const ogrList= sinifSec ? ogrenciler.filter(o=>o.sinif===sinifSec) : ogrenciler;
 const tarihler=[...new Set(odevler.filter(o=>o.tarih.startsWith(ay)).map(o=>o.tarih))].sort();
 if(!tarihler.length){ alert('Bu ay için kayıt bulunamadı'); return; }

 doc.text(`${okulAdi} - ${ogretmenAdi}`,10,10);
 doc.text(`${sinifSec?sinifSec+' - ':''}Aylık Ödev Raporu (${ay})`,10,18);
 // Başlık satırı
 doc.setFillColor(220,230,241);
 doc.rect(8,24,280,10,'F');
 doc.setTextColor(0,0,0);
 doc.text('No',10,31); doc.text('Ad Soyad',30,31);
 tarihler.forEach((t,i)=>doc.text(t,70+i*30,31));
 y=44;
 ogrList.forEach(o=>{
  doc.text(o.no,10,y); doc.text(o.ad,30,y);
  tarihler.forEach((t,i)=>{
   const r=odevler.find(x=>x.no===o.no&&x.tarih===t);
   if(!r) return;
   const d=r.durum; const c=renk(d);
   if(c){doc.setFillColor(...c); doc.rect(65+i*30,y-6,28,8,'F');}
   doc.setTextColor(0,0,0);
   doc.text(d==='yapti'?'Yaptı':d==='yapmadi'?'Yapmadı':'Gelmedi',70+i*30,y);
  });
  y+=8;
 });
 doc.save(`aylik_${sinifSec?sinifSec+'_':''}${ay}.pdf`);
}

siniflariYukle();
</script>
</body>
</html>
