<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“˜ Ã–dev Takip Sistemi</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<meta name="theme-color" content="#3498db">
<style>
body{font-family:Arial,sans-serif;background:#f4f6f8;margin:0;padding:10px}
h1,h2{text-align:center}
.section{background:#fff;padding:15px;margin-bottom:15px;border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,.1)}
input,select,button{width:100%;padding:12px;margin-top:6px;margin-bottom:12px;font-size:1rem}
button{border:none;border-radius:10px;background:#3498db;color:#fff}
button.secondary{background:#7f8c8d}
button.danger{background:#e74c3c}
.ogrenci{background:#ecf0f1;padding:10px;border-radius:10px;margin-bottom:8px}
.row{display:flex;gap:8px;margin-top:8px}
.row button{flex:1}
.gecmis{font-size:0.9rem;margin-top:6px}
.header-title{text-align:center;font-weight:bold;font-size:1.2rem;margin-bottom:8px}
</style>
</head>
<body>

<h1>ğŸ“˜ Ã–dev Takip Sistemi</h1>

<!-- Okul ve Ã–ÄŸretmen AdÄ± -->
<div class="section" id="okulOgretmenSection">
<h2>ğŸ“ Okul ve Ã–ÄŸretmen Bilgisi</h2>
<input id="okul" placeholder="Okul AdÄ±">
<input id="ogretmen" placeholder="Ã–ÄŸretmen AdÄ±">
<button id="kaydetOkulBtn">Kaydet</button>
</div>

<div id="mainApp" style="display:none">

<div class="section">
<h2>ğŸ‘¨â€ğŸ“ Ã–ÄŸrenci YÃ¶netimi</h2>
<input id="ad" placeholder="Ad Soyad">
<input id="no" placeholder="Numara">
<input id="sinif" placeholder="SÄ±nÄ±f">
<button id="kaydetBtn" type="button">Kaydet</button>
<button id="iptalBtn" type="button" class="secondary">Ä°ptal</button>
<hr>
<input id="arama" placeholder="Ã–ÄŸrenci adÄ± veya no ile ara">
<div id="aramaSonuc"></div>
</div>

<div class="section">
<h2>ğŸ“‹ Ã–dev Kontrol</h2>
<input type="date" id="odevTarih">
<select id="odevSinif"><option value="">SÄ±nÄ±f SeÃ§</option></select>
<select id="odevOgrenciSec" size="6"></select>
<div id="odevIslem"></div>
</div>

<div class="section">
<h2>ğŸ“œ Ã–dev GeÃ§miÅŸi</h2>
<select id="gecmisSinif"><option value="">SÄ±nÄ±f SeÃ§</option></select>
<select id="gecmisOgrenci"></select>
<div id="gecmisListe"></div>
</div>

<div class="section">
<h2>ğŸ“Š PDF Rapor</h2>
<label>GÃ¼nlÃ¼k Rapor</label>
<input type="date" id="gunlukPdfTarih">
<button onclick="gunlukPdf()">ğŸ“„ GÃ¼nlÃ¼k PDF</button>
<hr>
<label>AylÄ±k Rapor</label>
<input type="month" id="raporAy">
<button onclick="aylikPdf()">ğŸ“„ AylÄ±k PDF</button>
</div>

<div class="section">
<h2>ğŸ’¾ Yedekleme</h2>
<button onclick="jsonYedekAl()">â¬‡ï¸ JSON Yedek Al</button>
<input type="file" id="jsonFile" accept="application/json">
<button class="secondary" onclick="jsonYukle()">â¬†ï¸ Yedekten YÃ¼kle</button>
</div>

</div>

<script>
let ogrenciler = JSON.parse(localStorage.getItem('ogrenciler')) || [];
let odevler = JSON.parse(localStorage.getItem('odevler')) || [];
let seciliNo = null;

const adInp = document.getElementById('ad');
const noInp = document.getElementById('no');
const sinifInp = document.getElementById('sinif');
const kaydetBtn = document.getElementById('kaydetBtn');
const iptalBtn = document.getElementById('iptalBtn');
const aramaInp = document.getElementById('arama');
const sonucDiv = document.getElementById('aramaSonuc');
const odevSinif = document.getElementById('odevSinif');
const odevOgrenciSec = document.getElementById('odevOgrenciSec');
const odevTarih = document.getElementById('odevTarih');
const gecmisOgrenci = document.getElementById('gecmisOgrenci');
const gecmisListe = document.getElementById('gecmisListe');
const gecmisSinif = document.getElementById('gecmisSinif');

const okulInp = document.getElementById('okul');
const ogretmenInp = document.getElementById('ogretmen');
const kaydetOkulBtn = document.getElementById('kaydetOkulBtn');

odevTarih.value = new Date().toISOString().split('T')[0];

// Okul ve Ã¶ÄŸretmen kaydÄ±
if(localStorage.getItem('okul') && localStorage.getItem('ogretmen')){
    okulInp.value = localStorage.getItem('okul');
    ogretmenInp.value = localStorage.getItem('ogretmen');
    document.getElementById('okulOgretmenSection').style.display='none';
    document.getElementById('mainApp').style.display='block';
}

kaydetOkulBtn.onclick = ()=>{
    if(!okulInp.value.trim()||!ogretmenInp.value.trim()){alert('Her iki alanÄ± da doldurun');return;}
    localStorage.setItem('okul',okulInp.value.trim());
    localStorage.setItem('ogretmen',ogretmenInp.value.trim());
    document.getElementById('okulOgretmenSection').style.display='none';
    document.getElementById('mainApp').style.display='block';
};

// Ã–ÄŸrenci kaydet
function kaydet(){
 const ad = adInp.value.trim();
 const no = noInp.value.trim();
 const sinif = sinifInp.value.trim();
 if(!ad||!no||!sinif){alert('TÃ¼m alanlarÄ± doldurun');return;}
 if(seciliNo){
  const o = ogrenciler.find(x=>x.no===seciliNo);
  o.ad=ad; o.no=no; o.sinif=sinif;
  seciliNo=null; kaydetBtn.textContent='Kaydet';
 } else {
  if(ogrenciler.some(x=>x.no===no)){alert('Numara zaten var');return;}
  ogrenciler.push({ad,no,sinif});
 }
 localStorage.setItem('ogrenciler',JSON.stringify(ogrenciler));
 temizle(); siniflariDoldur(); ogrenciDropdown(); sinifGuncelle(); alert('Kaydedildi');
}

function temizle(){adInp.value=noInp.value=sinifInp.value='';}
function iptal(){temizle();seciliNo=null;kaydetBtn.textContent='Kaydet';}

function arama(){
 const q = aramaInp.value.toLowerCase(); sonucDiv.innerHTML='';
 if(!q) return;
 ogrenciler.filter(o=>o.ad.toLowerCase().includes(q)||o.no.includes(q)).forEach(o=>{
  const d=document.createElement('div'); d.className='ogrenci';
  d.innerHTML=`<b>${o.ad}</b><br>No:${o.no} | ${o.sinif}
  <div class='row'>
   <button onclick="duzenle('${o.no}')">GÃ¼ncelle</button>
   <button class='danger' onclick="sil('${o.no}')">Sil</button>
  </div>`;
  sonucDiv.appendChild(d);
 });
}

function duzenle(no){
 const o=ogrenciler.find(x=>x.no===no);
 adInp.value=o.ad; noInp.value=o.no; sinifInp.value=o.sinif;
 seciliNo=no; kaydetBtn.textContent='GÃ¼ncelle';
}

function sil(no){
 if(!confirm('Silinsin mi?')) return;
 ogrenciler=ogrenciler.filter(x=>x.no!==no);
 odevler=odevler.filter(x=>x.no!==no);
 localStorage.setItem('ogrenciler',JSON.stringify(ogrenciler));
 localStorage.setItem('odevler',JSON.stringify(odevler));
 siniflariDoldur(); ogrenciDropdown(); sinifGuncelle(); arama();
}

// SÄ±nÄ±f dropdown doldur
function siniflariDoldur(){
 odevSinif.innerHTML='<option value="">SÄ±nÄ±f SeÃ§</option>';
 const siniflar=[...new Set(ogrenciler.map(o=>o.sinif.trim().toUpperCase()))];
 siniflar.forEach(s=>{const opt=document.createElement('option');opt.value=s;opt.textContent=s;odevSinif.appendChild(opt);});
}

// Ã–dev kontrol dropdown
odevSinif.onchange=()=>{
 odevOgrenciSec.innerHTML='';
 ogrenciler.filter(o=>o.sinif.toUpperCase()===odevSinif.value)
 .forEach(o=>{const opt=document.createElement('option');opt.value=o.no;opt.textContent=`${o.ad} (${o.no})`;odevOgrenciSec.appendChild(opt);});
};

// Ã–dev kaydet
odevOgrenciSec.onchange=()=>{
 const no=odevOgrenciSec.value;
 const div=document.getElementById('odevIslem');
 div.innerHTML=`<button onclick="odevKaydet('${no}','YaptÄ±')">âœ… YaptÄ±</button>
 <button onclick="odevKaydet('${no}','YapmadÄ±')" class='danger'>âŒ YapmadÄ±</button>
 <button onclick="odevKaydet('${no}','Gelmedi')" class='secondary'>ğŸš« Gelmedi</button>`;
};

function odevKaydet(no,durum){
 const tarih=odevTarih.value;
 const i=odevler.findIndex(o=>o.no===no&&o.tarih===tarih);
 if(i>-1) odevler[i].yapti=durum; else odevler.push({no,tarih,yapti:durum});
 localStorage.setItem('odevler',JSON.stringify(odevler)); alert('Kaydedildi');
}

// Ã–dev geÃ§miÅŸi
function ogrenciDropdown(){
 gecmisOgrenci.innerHTML='<option value="">Ã–ÄŸrenci SeÃ§</option>';
 ogrenciler.forEach(o=>{
    const opt=document.createElement('option');
    opt.value=o.no;
    opt.textContent=`${o.ad} (${o.no})`;
    gecmisOgrenci.appendChild(opt);
 });
}
function sinifGuncelle(){
 gecmisSinif.innerHTML='<option value="">SÄ±nÄ±f SeÃ§</option>';
 [...new Set(ogrenciler.map(o=>o.sinif))].forEach(s=>{
    const opt=document.createElement('option'); opt.value=s; opt.textContent=s; gecmisSinif.appendChild(opt);
 });
}

// Filtreli Ã¶dev geÃ§miÅŸi
gecmisSinif.onchange=()=>{gecmisOgrenciDropdown();}
function gecmisOgrenciDropdown(){
    const secilenSinif = gecmisSinif.value;
    gecmisOgrenci.innerHTML = '<option value="">Ã–ÄŸrenci SeÃ§</option>';
    ogrenciler.filter(o=>!secilenSinif || o.sinif===secilenSinif)
        .forEach(o=>{
            const opt=document.createElement('option');
            opt.value=o.no; 
            opt.textContent=`${o.ad} (${o.no})`; 
            gecmisOgrenci.appendChild(opt);
        });
}

gecmisOgrenci.onchange=()=>{
    gecmisListe.innerHTML='';
    const secilenNo = gecmisOgrenci.value;
    if(!secilenNo) return;
    odevler.filter(o=>o.no===secilenNo).forEach(o=>{
        const ogr = ogrenciler.find(x=>x.no===o.no);
        const d=document.createElement('div');
        d.className='ogrenci gecmis';
        d.textContent = `${o.tarih} â†’ ${o.yapti}`;
        gecmisListe.appendChild(d);
    });
};

// PDF GÃ¼nlÃ¼k
function gunlukPdf(){
 const tarih=document.getElementById('gunlukPdfTarih').value;
 if(!tarih){alert('Tarih seÃ§in');return;}
 const { jsPDF } = window.jspdf;
 const doc=new jsPDF('p','pt','a4');
 const sinifSet=[...new Set(odevler.filter(o=>o.tarih===tarih).map(o=>ogrenciler.find(x=>x.no===o.no)?.sinif).filter(Boolean))];
 sinifSet.forEach(s=>{
     let y=50;
     const data = odevler.filter(o=>o.tarih===tarih).filter(o=>{
         const ogr=ogrenciler.find(x=>x.no===o.no); return ogr?ogr.sinif===s:false;
     }).map(o=>{
         const ogr=ogrenciler.find(x=>x.no===o.no); return {no:ogr.no, ad:ogr.ad, durum:o.yapti};
     });
     doc.setFontSize(14); doc.text(`${s} - GÃ¼nlÃ¼k Ã–dev Raporu`,40,30);
     // Tablo baÅŸlÄ±k
     doc.setFontSize(12);
     doc.setFillColor(200,200,200);
     doc.rect(40, y, 500, 20, 'F');
     doc.setTextColor(0,0,0);
     doc.text("No",45,y+15); doc.text("Ad Soyad",90,y+15); doc.text("Durum",400,y+15);
     y+=20;
     data.forEach((d,i)=>{
         if(y>750){doc.addPage(); y=50; doc.setFillColor(200,200,200); doc.rect(40, y, 500, 20, 'F'); doc.setTextColor(0,0,0);
         doc.text("No",45,y+15); doc.text("Ad Soyad",90,y+15); doc.text("Durum",400,y+15); y+=20;}
         doc.text(d.no,45,y+15); doc.text(d.ad,90,y+15); doc.text(d.durum,400,y+15); y+=20;
     });
     const filename = `gunluk_${s}_${tarih}.pdf`;
     doc.save(filename);
 });
}

// PDF AylÄ±k
function aylikPdf(){
 const ay=document.getElementById('raporAy').value;
 if(!ay){alert('Ay seÃ§in');return;}
 const { jsPDF } = window.jspdf;
 const doc=new jsPDF('p','pt','a4');
 const sinifSet=[...new Set(odevler.filter(o=>o.tarih.startsWith(ay)).map(o=>ogrenciler.find(x=>x.no===o.no)?.sinif).filter(Boolean))];
 sinifSet.forEach(s=>{
     let y=50;
     const tarihSet = [...new Set(odevler.filter(o=>o.tarih.startsWith(ay)).filter(o=>{
         const ogr=ogrenciler.find(x=>x.no===o.no); return ogr?ogr.sinif===s:false;
     }).map(o=>o.tarih))];
     const data = ogrenciler.filter(o=>o.sinif===s).map(o=>{
         const satir={no:o.no, ad:o.ad};
         tarihSet.forEach(t=>{ 
             const odev = odevler.find(od=>od.no===o.no && od.tarih===t);
             satir[t] = odev?odev.yapti:'Gelmedi';
         });
         return satir;
     });
     doc.setFontSize(14); doc.text(`${s} - AylÄ±k Ã–dev Raporu`,40,30);
     // BaÅŸlÄ±klar
     doc.setFontSize(12); doc.setFillColor(200,200,200); doc.rect(40,y,500+(tarihSet.length-1)*50,20,'F'); doc.setTextColor(0,0,0);
     doc.text("No",45,y+15); doc.text("Ad Soyad",90,y+15);
     tarihSet.forEach((t,i)=>{doc.text(t,140+i*50,y+15)});
     y+=20;
     data.forEach((d)=>{
         if(y>750){doc.addPage(); y=50; doc.setFillColor(200,200,200); doc.rect(40,y,500+(tarihSet.length-1)*50,20,'F'); doc.setTextColor(0,0,0);
         doc.text("No",45,y+15); doc.text("Ad Soyad",90,y+15); 
         tarihSet.forEach((t,i)=>{doc.text(t,140+i*50,y+15)}); y+=20;}
         doc.text(d.no,45,y+15); doc.text(d.ad,90,y+15);
         tarihSet.forEach((t,i)=>{doc.text(d[t]||'Gelmedi',140+i*50,y+15)});
         y+=20;
     });
     const filename = `aylik_${s}_${ay}.pdf`;
     doc.save(filename);
 });
}

// JSON Yedekleme
function jsonYedekAl(){
 const blob=new Blob([JSON.stringify({ogrenciler,odevler},null,2)],{type:'application/json'});
 const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='odev_yedek.json';a.click();
}

function jsonYukle(){
 const f=document.getElementById('jsonFile').files[0]; if(!f) return;
 const r=new FileReader(); r.onload=e=>{
  const d=JSON.parse(e.target.result);
  d.ogrenciler.forEach(o=>{if(!ogrenciler.some(x=>x.no===o.no)) ogrenciler.push(o);});
  d.odevler.forEach(o=>{if(!odevler.some(x=>x.no===o.no&&x.tarih===o.tarih)) odevler.push(o);});
  localStorage.setItem('ogrenciler',JSON.stringify(ogrenciler));
  localStorage.setItem('odevler',JSON.stringify(odevler));
  siniflariDoldur(); ogrenciDropdown(); sinifGuncelle(); alert('YÃ¼klendi');
 };
 r.readAsText(f);
}

kaydetBtn.addEventListener('click',kaydet);
iptalBtn.addEventListener('click',iptal);
aramaInp.addEventListener('input',arama);
siniflariDoldur(); ogrenciDropdown(); sinifGuncelle();
</script>
</body>
</html>