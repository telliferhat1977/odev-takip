<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SinemaTV Pro v34.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --n-red: #E50914; --n-black: #080808; }
        body { background-color: var(--n-black); color: white; font-family: sans-serif; margin: 0; padding: 5px; overflow-x: hidden; }
        .item-grid { display: grid; grid-template-cols: repeat(4, 1fr); gap: 8px; }
        @media (min-width: 768px) { .item-grid { grid-template-cols: repeat(8, 1fr); } }
        .full-modal { display: none; position: fixed; inset: 0; background: var(--n-black); padding: 15px; overflow-y: auto; z-index: 2000; }
        .show-modal { display: block !important; }
        .h-scroll { display: flex; overflow-x: auto; gap: 8px; width: 100%; padding: 10px 0; scrollbar-width: none; }
        .cast-card { flex: 0 0 70px; text-align: center; cursor: pointer; }
        .cast-card img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid #333; }
        .load-more-btn { width: 100%; margin: 20px 0 40px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; color: #666; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .metadata-btn { width: 100%; max-width: 280px; margin-top: 25px; padding: 14px; background: #1a1a1a; border: 1px solid #444; border-radius: 12px; color: #eee; font-size: 11px; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 8px; }
        #videoLayer { z-index: 9999; position: fixed; inset: 0; background: black; display: none; flex-direction: column; }
    </style>
</head>
<body onload="initApp()">

    <div id="mainUI">
        <header class="flex flex-col items-center mb-6">
            <h1 class="text-2xl font-black italic text-red-600 my-4 tracking-tighter">Sinema<span class="text-white">TV PRO</span></h1>
            <div class="flex w-full gap-2 px-2">
                <input type="text" id="searchInput" placeholder="Film veya oyuncu ara..." class="bg-[#151515] p-3 flex-1 rounded-xl outline-none text-sm text-white">
                <button onclick="resetAndSearch()" class="bg-[#E50914] px-6 rounded-xl text-white"><i class="fas fa-search"></i></button>
            </div>
        </header>
        <div id="results" class="item-grid"></div>
        <button id="loadMoreMain" onclick="loadMoreContent()" class="load-more-btn">DAHA FAZLA</button>
    </div>

    <div id="detailPage" class="full-modal">
        <button onclick="history.back()" class="mb-4 bg-white/10 px-6 py-2 rounded-full text-xs font-bold uppercase">← GERİ</button>
        <div class="flex flex-col items-center">
            <img id="detailPoster" src="" class="max-h-[260px] rounded-3xl shadow-2xl mb-4">
            <h2 id="detailTitle" class="text-xl font-black text-center px-4 leading-tight mb-2"></h2>
            <div class="w-full px-2 mb-4">
                <p class="text-[10px] text-gray-500 font-bold uppercase mb-2">OYUNCULAR</p>
                <div id="castList" class="h-scroll"></div>
            </div>
            <button onclick="startAutoPlay()" class="bg-[#E50914] w-full max-w-xs py-4 rounded-2xl font-black text-sm text-white shadow-lg">▶ ŞİMDİ İZLE</button>
            <button onclick="openPin()" class="metadata-btn"><i class="fas fa-database text-red-600"></i> METADATA</button>
        </div>
    </div>

    <div id="personPage" class="full-modal">
        <button onclick="history.back()" class="mb-6 bg-white/10 px-6 py-2 rounded-full text-xs font-bold uppercase">← GERİ</button>
        <div class="flex flex-col items-center mb-6">
            <img id="personImg" src="" class="w-[140px] h-[140px] rounded-full border-4 border-red-600 object-cover shadow-2xl mb-2">
            <h2 id="personName" class="text-2xl font-black text-red-600 text-center uppercase"></h2>
        </div>
        <div id="personCredits" class="item-grid"></div>
        <button id="loadMorePerson" class="load-more-btn">DAHA FAZLA FİLMOGRAFİ</button>
    </div>

    <div id="pinOverlay" class="fixed inset-0 z-[9000] hidden items-center justify-center bg-black/95">
        <div class="bg-[#111] p-8 rounded-3xl text-center w-[85%] max-w-xs border border-white/10">
            <h3 class="text-white font-bold text-xs">PIN KODU</h3>
            <input type="password" id="pinInput" maxlength="4" class="bg-black border-2 border-red-600 text-white text-center text-2xl w-32 p-3 my-6 rounded-2xl outline-none">
            <div class="flex gap-2">
                <button onclick="closePin()" class="flex-1 py-3 bg-gray-800 rounded-xl text-xs font-bold">İPTAL</button>
                <button onclick="checkPin()" class="flex-1 py-3 bg-red-600 rounded-xl text-xs font-bold">GİRİŞ</button>
            </div>
        </div>
    </div>

    <div id="externalModal" class="full-modal" style="z-index: 9500;">
        <div class="max-w-md mx-auto">
            <button onclick="document.getElementById('externalModal').classList.remove('show-modal')" class="mb-8 bg-white/10 px-6 py-2 rounded-full text-xs font-bold uppercase">← KAPAT</button>
            <div id="externalList" class="flex flex-col gap-3"></div>
        </div>
    </div>

    <div id="videoLayer">
        <div class="p-3 bg-black flex justify-between items-center border-b border-white/10">
            <button onclick="closePlayer()" class="bg-white/10 px-6 py-2 rounded-full text-xs font-bold text-white">KAPAT</button>
        </div>
        <iframe id="playerFrame" src="" class="flex-1 w-full border-none" allowfullscreen></iframe>
    </div>

    <script>
        const TMDB_KEY = "847629da5649502fa6655f73b15a5c8e";
        const SAFE_PIN = "1739";
        let mainPage = 1, currentItem = {}, personPageNum = 1, personFullCredits = [];

        function initApp() { loadContent(); }

        async function loadContent(page = 1) {
            const q = document.getElementById('searchInput').value;
            let url = q ? `https://api.themoviedb.org/3/search/multi?api_key=${TMDB_KEY}&query=${encodeURIComponent(q)}&language=tr-TR&page=${page}`
                        : `https://api.themoviedb.org/3/trending/all/day?api_key=${TMDB_KEY}&language=tr-TR&page=${page}`;
            const res = await fetch(url);
            const data = await res.json();
            displayItems(data.results, 'results', page > 1);
            document.getElementById('loadMoreMain').style.display = data.page < data.total_pages ? 'block' : 'none';
        }

        function resetAndSearch() { mainPage = 1; document.getElementById('results').innerHTML = ""; loadContent(1); }
        function loadMoreContent() { mainPage++; loadContent(mainPage); }

        function displayItems(items, targetId, append = false) {
            const container = document.getElementById(targetId);
            if(!append) container.innerHTML = "";
            items.forEach(item => {
                if(item.poster_path) {
                    // TÜR BELİRLEME MANTIĞI (FİX)
                    let type = item.media_type;
                    if(!type) {
                        type = (item.first_air_date || item.name) ? 'tv' : 'movie';
                    }

                    const card = document.createElement('div');
                    card.className = "flex flex-col cursor-pointer active:scale-95 transition-transform";
                    card.style.zIndex = "10";
                    card.innerHTML = `
                        <img src="https://image.tmdb.org/t/p/w300${item.poster_path}" class="rounded-xl aspect-[2/3] object-cover shadow-lg border border-white/5">
                        <div class="text-[7px] font-bold truncate mt-2 uppercase text-center text-gray-500 px-1">${item.title || item.name}</div>
                    `;
                    
                    card.onclick = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        history.pushState({modal: 'detailPage'}, ""); 
                        openDetails(item.id, type); 
                    };
                    container.appendChild(card);
                }
            });
        }

        async function openDetails(id, type) {
            try {
                const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB_KEY}&language=tr-TR&append_to_response=credits`);
                const data = await res.json();
                currentItem = { id, type, title: data.title || data.name };
                
                document.getElementById('detailTitle').innerText = currentItem.title;
                document.getElementById('detailPoster').src = `https://image.tmdb.org/t/p/w500${data.poster_path}`;
                
                const castDiv = document.getElementById('castList'); 
                castDiv.innerHTML = "";
                if(data.credits && data.credits.cast) {
                    data.credits.cast.slice(0, 15).forEach(p => {
                        const card = document.createElement('div'); 
                        card.className = "cast-card";
                        card.innerHTML = `<img src="https://image.tmdb.org/t/p/w185${p.profile_path || ''}" onerror="this.src='https://via.placeholder.com/150'"><div class="text-[7px] mt-1 truncate font-medium text-gray-500">${p.name}</div>`;
                        card.onclick = (e) => { 
                            e.stopPropagation();
                            history.pushState({modal: 'personPage'}, ""); 
                            openPersonDetails(p.id); 
                        };
                        castDiv.appendChild(card);
                    });
                }
                
                const modal = document.getElementById('detailPage');
                modal.classList.add('show-modal');
                modal.scrollTo(0,0);
            } catch (err) { console.error("Detay yükleme hatası:", err); }
        }

        async function openPersonDetails(id) {
            personPageNum = 1;
            const res = await fetch(`https://api.themoviedb.org/3/person/${id}?api_key=${TMDB_KEY}&language=tr-TR&append_to_response=combined_credits`);
            const data = await res.json();
            
            document.getElementById('personName').innerText = data.name;
            document.getElementById('personImg').src = `https://image.tmdb.org/t/p/w500${data.profile_path}`;
            
            personFullCredits = data.combined_credits.cast
                .filter(i => i.poster_path)
                .sort((a,b) => b.vote_count - a.vote_count);
            
            renderPersonCredits(false);
            const modal = document.getElementById('personPage');
            modal.classList.add('show-modal');
            modal.scrollTo(0,0);
        }

        function renderPersonCredits(append = false) {
            const itemsPerPage = 16;
            const start = (personPageNum - 1) * itemsPerPage;
            const end = personPageNum * itemsPerPage;
            const pageItems = personFullCredits.slice(start, end);
            displayItems(pageItems, 'personCredits', append);
            const btn = document.getElementById('loadMorePerson');
            btn.style.display = end < personFullCredits.length ? 'block' : 'none';
            btn.onclick = () => { personPageNum++; renderPersonCredits(true); };
        }

        function openPin() { document.getElementById('pinInput').value = ""; document.getElementById('pinOverlay').style.display = 'flex'; }
        function closePin() { document.getElementById('pinOverlay').style.display = 'none'; }
        function checkPin() {
            if(document.getElementById('pinInput').value === SAFE_PIN) { closePin(); openExternalMenu(); } 
            else { alert("PIN Hatalı!"); document.getElementById('pinInput').value = ""; }
        }

        function openExternalMenu() {
            const list = document.getElementById('externalList'); list.innerHTML = "";
            const sources = ["EROGARGA", "TUBE PORN CLASSIC", "XNXX", "XVIDEOS", "NOODLE MAGAZINE"];
            sources.forEach(src => {
                const b = document.createElement('button');
                b.className = "bg-[#111] p-6 rounded-2xl text-left text-xs font-black text-white border border-white/5 active:bg-red-900 w-full mb-1";
                b.innerText = src;
                b.onclick = () => window.open(getSearchUrl(src), '_blank');
                list.appendChild(b);
            });
            document.getElementById('externalModal').classList.add('show-modal');
        }

        function getSearchUrl(site) {
            const q = encodeURIComponent(currentItem.title.split('(')[0].trim());
            const sites = {
                "EROGARGA": `https://www.erogarga.com/?s=${q}`, "TUBE PORN CLASSIC": `https://tubepornclassic.com/search/1/?s=${q}`,
                "NOODLE MAGAZINE": `https://noodlemagazine.com/video/${q}`, "XNXX": `https://www.xnxx.com/search/${q.replace(/%20/g, '+')}`,
                "XVIDEOS": `https://www.xvideos.com/?k=${q.replace(/%20/g, '+')}`
            };
            return sites[site];
        }

        function startAutoPlay() {
            const url = currentItem.type === 'tv' ? `https://vidsrc.me/embed/tv?tmdb=${currentItem.id}&sea=1&epi=1&ds_lang=tr` : `https://vidsrc.me/embed/movie?tmdb=${currentItem.id}&ds_lang=tr`;
            document.getElementById('playerFrame').src = url;
            document.getElementById('videoLayer').style.display = 'flex';
            history.pushState({player: true}, "");
        }
        function closePlayer() { document.getElementById('playerFrame').src = ""; document.getElementById('videoLayer').style.display = 'none'; }

        window.onpopstate = function() {
            const openModals = Array.from(document.querySelectorAll('.show-modal'));
            if (document.getElementById('videoLayer').style.display === 'flex') {
                closePlayer();
            } else if (openModals.length > 0) {
                openModals[openModals.length - 1].classList.remove('show-modal');
            }
            closePin();
        };
    </script>
</body>
</html>