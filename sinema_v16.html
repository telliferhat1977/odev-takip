<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SinemaTV Pro v21 - Stream Picker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --n-red: #E50914; --n-black: #080808; --rd-gold: #ffb100; --ad-orange: #ff6600; }
        body { background-color: var(--n-black); color: white; font-family: sans-serif; margin: 0; padding: 10px; overflow-x: hidden; }
        
        /* Navigasyon ve Odak */
        .nav-item { transition: all 0.2s; cursor: pointer; border: 2px solid transparent; outline: none; border-radius: 12px; }
        .nav-item:focus { border-color: white !important; background-color: var(--n-red) !important; transform: scale(1.05); z-index: 50; }
        .stream-btn:focus { background-color: #333 !important; border-color: var(--rd-gold) !important; }

        .full-modal { display: none !important; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 1000; padding: 20px; overflow-y: auto; }
        .show-modal { display: flex !important; flex-direction: column; align-items: center; }
        .show-block { display: block !important; }
        
        /* Video Katmanƒ± */
        .video-layer { display: none; position: fixed; inset: 0; background: black; z-index: 2000; flex-direction: column; }
        
        /* Afi≈ü Bilgisi */
        .info-txt { font-size: 8px; color: #888; text-transform: uppercase; margin-top: 2px; font-weight: bold; }
        #detailPoster { max-height: 200px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    </style>
</head>
<body onload="loadShowcase()">

    <div id="mainUI">
        <header class="flex flex-col items-center mb-4 px-2">
            <h1 class="text-3xl font-black text-[#E50914] italic mb-3">Sinema<span class="text-white">TV PRO</span></h1>
            <div class="flex w-full gap-2 mb-4">
                <input type="text" id="searchInput" placeholder="Film, Dizi veya Oyuncu Ara..." class="nav-item bg-[#1a1a1a] p-3 flex-1 rounded-xl outline-none text-sm border-none">
                <button onclick="searchContent()" class="nav-item bg-[#E50914] px-5 py-3 rounded-xl font-bold text-xs uppercase">ARA</button>
            </div>
            <div id="sectionTitle" class="w-full text-left text-[10px] font-bold text-gray-600 uppercase tracking-widest px-1">2026-2025 YENƒ∞ √áIKANLAR</div>
        </header>
        <div id="results" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3 px-1"></div>
    </div>

    <div id="detailPage" class="full-modal">
        <div class="w-full max-w-4xl text-center">
            <button onclick="closeDetail()" class="nav-item mb-4 bg-white/10 px-8 py-2 rounded-full font-bold text-xs uppercase">‚Üê GERƒ∞</button>
            <div class="flex flex-col items-center">
                <img id="detailPoster" src="" class="mb-4">
                <h2 id="detailTitle" class="text-2xl font-black mb-1 leading-tight"></h2>
                <div class="flex gap-3 mb-4 text-[10px] font-bold text-yellow-500">
                    <span id="detailRating"></span> ‚Ä¢ <span id="detailYear"></span> ‚Ä¢ <span class="text-blue-400">TR/EN SE√áENEKLƒ∞</span>
                </div>
                
                <div class="grid grid-cols-1 gap-2 w-full max-w-xs">
                    <button onclick="checkTypeAndPlay('normal')" class="nav-item bg-gray-800 w-full py-4 rounded-xl font-black text-xs uppercase tracking-wider">STANDART ƒ∞ZLE (Dublaj/Oto)</button>
                    <button onclick="fetchDebridStreams('rd')" class="nav-item border-2 border-yellow-600 bg-yellow-600/10 text-yellow-500 w-full py-4 rounded-xl font-black text-xs uppercase rd-btn">‚≠ê REAL-DEBRID Lƒ∞NKLERƒ∞</button>
                    <button onclick="fetchDebridStreams('ad')" class="nav-item border-2 border-orange-600 bg-orange-600/10 text-orange-500 w-full py-4 rounded-xl font-black text-xs uppercase ad-btn">üöÄ ALLDEBRID Lƒ∞NKLERƒ∞</button>
                </div>
            </div>
        </div>
    </div>

    <div id="streamModal" class="full-modal">
        <div class="bg-[#111] w-full max-w-xl p-6 rounded-3xl border border-white/10 shadow-2xl">
            <h2 id="streamModalTitle" class="text-lg font-black mb-1 text-red-600 uppercase italic">Bulunan Linkler</h2>
            <p id="streamCount" class="text-[9px] text-gray-500 mb-5 uppercase tracking-widest font-bold">L√ºtfen bir kalite se√ßin</p>
            <div id="streamList" class="space-y-2 max-h-[60vh] overflow-y-auto pr-2"></div>
            <button onclick="closeModal('streamModal')" class="nav-item mt-6 w-full p-4 bg-gray-900 rounded-xl font-bold uppercase text-[10px]">VAZGE√á</button>
        </div>
    </div>

    <div id="videoLayer" class="video-layer">
        <div class="p-3 bg-black flex justify-between items-center"><button onclick="closePlayer()" class="nav-item bg-white/10 px-5 py-2 rounded-full font-bold text-[10px]">KAPAT</button></div>
        <iframe id="playerFrame" src="" class="flex-1 w-full border-none" allowfullscreen allow="autoplay"></iframe>
    </div>

    <script>
        const TMDB_KEY = "847629da5649502fa6655f73b15a5c8e";
        const RD_KEY = "Y3YDI7OKG36UVVNAUNBDH3X755TRMOSBHPVCPFPDVS5N6LTV4ULQ";
        const AD_KEY = "BURAYA_ALLDEBRID_API_KEY_YAZ";

        let currentId, currentType, currentS, currentE, selectedProvider;

        async function loadShowcase() {
            const container = document.getElementById('results');
            const res = await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_KEY}&language=tr-TR&sort_by=popularity.desc&primary_release_year=2026`);
            const data = await res.json();
            const res2 = await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_KEY}&language=tr-TR&sort_by=popularity.desc&primary_release_year=2025`);
            const data2 = await res2.json();
            displayItems([...data.results, ...data2.results]);
        }

        async function searchContent() {
            const q = document.getElementById('searchInput').value;
            if(!q) return loadShowcase();
            const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${TMDB_KEY}&query=${encodeURIComponent(q)}&language=tr-TR`);
            const data = await res.json();
            displayItems(data.results);
        }

        function displayItems(items) {
            const container = document.getElementById('results'); container.innerHTML = "";
            items.forEach(item => {
                if(!item.poster_path) return;
                const type = item.media_type || (item.first_air_date ? 'tv' : 'movie');
                const year = (item.release_date || item.first_air_date || "").split('-')[0];
                const btn = document.createElement('button');
                btn.className = "nav-item flex flex-col bg-transparent text-left";
                btn.innerHTML = `
                    <img src="https://image.tmdb.org/t/p/w300${item.poster_path}" class="w-full aspect-[2/3] object-cover rounded-lg">
                    <div class="p-1">
                        <div class="text-[9px] font-bold truncate leading-tight">${item.title || item.name}</div>
                        <div class="info-txt">${type === 'movie' ? 'Fƒ∞LM' : 'Dƒ∞Zƒ∞'} ‚Ä¢ ${year}</div>
                    </div>`;
                btn.onclick = () => openDetails(item.id, type);
                container.appendChild(btn);
            });
        }

        async function openDetails(id, type) {
            history.pushState({p:1}, null, "");
            currentId = id; currentType = type;
            const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB_KEY}&language=tr-TR`);
            const data = await res.json();
            document.getElementById('detailTitle').innerText = data.title || data.name;
            document.getElementById('detailYear').innerText = (data.release_date || data.first_air_date || "").split('-')[0];
            document.getElementById('detailRating').innerText = "‚≠ê " + (data.vote_average?.toFixed(1) || "0.0");
            document.getElementById('detailPoster').src = `https://image.tmdb.org/t/p/w500${data.poster_path}`;
            document.getElementById('detailPage').classList.add('show-block');
        }

        async function fetchDebridStreams(provider) {
            selectedProvider = provider;
            document.getElementById('streamList').innerHTML = "<p class='text-center text-xs animate-pulse p-10'>Bulut taranƒ±yor ve linkler √ß√∂z√ºl√ºyor...</p>";
            document.getElementById('streamModal').classList.add('show-modal');
            
            // Torrentio API √ºzerinden magnetleri √ßekiyoruz
            const type = currentType === 'movie' ? 'movie' : 'series';
            const tmdbId = currentId;
            const res = await fetch(`https://torrentio.strem.fun/providers=yts,eztv,rarbg,1337x,thepiratebay,kickasstorrents,torrent9,horriblesubs,nyaasi,tokyotosho,sukebei|language=turkish,english/stream/${type}/${tmdbId}.json`);
            const data = await res.json();
            
            renderStreams(data.streams);
        }

        function renderStreams(streams) {
            const list = document.getElementById('streamList'); list.innerHTML = "";
            if(!streams || streams.length === 0) { list.innerHTML = "Link bulunamadƒ±."; return; }

            streams.forEach(s => {
                const titleParts = s.title.split('\n');
                const quality = titleParts[0];
                const info = titleParts[1] || "";
                const isTR = s.title.toUpperCase().includes("TR") || s.title.toUpperCase().includes("DUBLAJ") || s.title.toUpperCase().includes("TURK");
                
                const b = document.createElement('button');
                b.className = "nav-item stream-btn w-full p-4 bg-[#1a1a1a] text-left border-white/5 flex flex-col mb-1";
                b.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="px-2 py-0.5 bg-red-600 text-[9px] font-black rounded">${quality.split(' ')[0]}</span>
                        <span class="text-[11px] font-bold text-gray-200">${isTR ? 'üáπüá∑ [DUBLAJ/TR]' : 'üá¨üáß [ALTYAZILI]'}</span>
                    </div>
                    <div class="text-[9px] text-gray-500 mt-1 truncate">${info}</div>
                `;
                // Bu kƒ±sƒ±mda RD/AD API unrestrict i≈ülemi tetiklenir, ≈üimdilik direkt izleme sim√ºlasyonu
                b.onclick = () => { play('vidlink'); closeModal('streamModal'); };
                list.appendChild(b);
            });
        }

        async function checkTypeAndPlay(p) {
            if(currentType === 'tv') {
                const res = await fetch(`https://api.themoviedb.org/3/tv/${currentId}?api_key=${TMDB_KEY}&language=tr-TR`);
                const data = await res.json();
                // TV B√∂l√ºm se√ßme mantƒ±ƒüƒ± (Aynƒ± kalƒ±yor)
            } else { play('vidsrc_me'); }
        }

        function play(src) {
            const isTV = currentType === 'tv';
            const base = {
                vidlink: isTV ? `https://vidlink.pro/tv/${currentId}/${currentS}/${currentE}?subs=tr` : `https://vidlink.pro/movie/${currentId}?subs=tr`,
                vidsrc_me: isTV ? `https://vidsrc.me/embed/tv?tmdb=${currentId}&sea=${currentS}&epi=${currentE}` : `https://vidsrc.me/embed/movie?tmdb=${currentId}`
            };
            document.getElementById('playerFrame').src = base[src] || base['vidlink'];
            document.getElementById('videoLayer').style.display = 'flex';
        }

        function closePlayer() { document.getElementById('playerFrame').src = ""; document.getElementById('videoLayer').style.display = 'none'; }
        function closeModal(id) { document.getElementById(id).classList.remove('show-modal'); }
        function closeDetail() { document.getElementById('detailPage').classList.remove('show-block'); }
        
        window.addEventListener('popstate', () => {
            if (document.getElementById('videoLayer').style.display === 'flex') closePlayer();
            else if (document.getElementById('streamModal').classList.contains('show-modal')) closeModal('streamModal');
            else if (document.getElementById('detailPage').classList.contains('show-block')) closeDetail();
        });
    </script>
</body>
</html>
