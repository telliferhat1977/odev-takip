<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SinemaTV Pro v31.1 - TR Sub Active</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --n-red: #E50914; --n-black: #080808; }
        body { background-color: var(--n-black); color: white; font-family: sans-serif; margin: 0; padding: 5px; overflow-x: hidden; }
        .item-grid { display: grid; grid-template-cols: repeat(4, 1fr); gap: 8px; }
        @media (min-width: 768px) { .item-grid { grid-template-cols: repeat(8, 1fr); } }
        .full-modal { display: none; position: fixed; inset: 0; background: var(--n-black); padding: 15px; overflow-y: auto; z-index: 2000; }
        .show-modal { display: block !important; }
        .h-scroll { display: flex; overflow-x: auto; gap: 8px; width: 100%; padding: 10px 0; scrollbar-width: none; }
        .cast-card { flex: 0 0 70px; text-align: center; cursor: pointer; }
        .cast-card img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 1px solid #333; margin: 0 auto; }
        .load-more-btn { width: 100%; margin: 20px 0 40px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; color: #666; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .source-btn { background: #1a1a1a; border: 1px solid #333; padding: 15px; border-radius: 12px; margin-bottom: 10px; width: 100%; text-align: left; font-size: 12px; font-weight: bold; color: #ccc; }
    </style>
</head>
<body onload="initApp()">

    <div id="mainUI">
        <header class="flex flex-col items-center mb-6">
            <h1 class="text-2xl font-black italic text-red-600 my-4 tracking-tighter">Sinema<span class="text-white">TV PRO</span></h1>
            <div class="flex w-full gap-2 px-2">
                <input type="text" id="searchInput" placeholder="Ara..." class="bg-[#151515] p-3 flex-1 rounded-xl outline-none text-sm text-white">
                <button onclick="resetAndSearch()" class="bg-[#E50914] px-6 rounded-xl text-white"><i class="fas fa-search"></i></button>
            </div>
        </header>
        <div id="results" class="item-grid"></div>
        <button id="loadMoreMain" onclick="loadMoreContent()" class="load-more-btn">DAHA FAZLA</button>
    </div>

    <div id="detailPage" class="full-modal">
        <button onclick="history.back()" class="mb-4 bg-white/10 px-6 py-2 rounded-full text-xs font-bold uppercase">← GERİ</button>
        <div class="flex flex-col items-center">
            <img id="detailPoster" src="" class="max-h-[260px] rounded-3xl shadow-2xl mb-4">
            <h2 id="detailTitle" class="text-xl font-black text-center px-4 leading-tight mb-2"></h2>
            <div class="w-full px-2 mb-4">
                <p class="text-[10px] text-gray-500 font-bold uppercase mb-2">OYUNCULAR</p>
                <div id="castList" class="h-scroll"></div>
            </div>
            <button onclick="alert('Stream başlatılıyor...')" class="bg-[#E50914] w-full max-w-xs py-4 rounded-2xl font-black text-sm text-white shadow-lg mb-3 uppercase">▶ Şimdi İzle</button>
            <button onclick="showSources()" class="bg-[#1a1a1a] border border-[#333] w-full max-w-xs py-3 rounded-2xl font-bold text-xs text-gray-500 uppercase">
                <i class="fas fa-database mr-2 text-red-600"></i> Harici Kaynaklar
            </button>
        </div>
    </div>

    <div id="personPage" class="full-modal">
        <button onclick="history.back()" class="mb-6 bg-white/10 px-6 py-2 rounded-full text-xs font-bold uppercase">← GERİ</button>
        <div class="flex flex-col items-center mb-6">
            <img id="personImg" src="" style="width:150px; height:150px; border-radius:50%; border:4px solid #E50914; object-fit:cover; margin-bottom:15px;">
            <h2 id="personName" class="text-2xl font-black text-red-600 text-center uppercase"></h2>
        </div>
        <div id="personCredits" class="item-grid"></div>
        <button id="loadMorePerson" class="load-more-btn">DAHA FAZLA FİLMOGRAFİ</button>
    </div>

    <div id="sourceModal" class="full-modal" style="z-index: 9500;">
        <button onclick="document.getElementById('sourceModal').classList.remove('show-modal')" class="mb-8 bg-white/10 px-6 py-2 rounded-full text-xs font-bold uppercase">← KAPAT</button>
        <h2 class="text-xl font-black text-red-600 mb-6 px-2 italic uppercase">Kaynaklar</h2>
        <div id="sourceList" class="px-2"></div>
    </div>

    <script>
        const TMDB_KEY = "847629da5649502fa6655f73b15a5c8e";
        let mainPage = 1, personPageNum = 1, personFullCredits = [], currentTitle = "";

        function initApp() { loadContent(); }

        async function loadContent(page = 1) {
            const q = document.getElementById('searchInput').value;
            let url = q ? `https://api.themoviedb.org/3/search/multi?api_key=${TMDB_KEY}&query=${encodeURIComponent(q)}&language=tr-TR&page=${page}`
                        : `https://api.themoviedb.org/3/trending/all/day?api_key=${TMDB_KEY}&language=tr-TR&page=${page}`;
            const res = await fetch(url);
            const data = await res.json();
            displayItems(data.results, 'results', page > 1);
            document.getElementById('loadMoreMain').style.display = data.page < data.total_pages ? 'block' : 'none';
        }

        function resetAndSearch() { mainPage = 1; document.getElementById('results').innerHTML = ""; loadContent(1); }
        function loadMoreContent() { mainPage++; loadContent(mainPage); }

        function displayItems(items, targetId, append = false) {
            const container = document.getElementById(targetId);
            if(!append) container.innerHTML = "";
            items.forEach(item => {
                let type = item.media_type;
                if(!type) type = (item.first_air_date || item.name) ? 'tv' : 'movie';

                if(type === 'person' || (!item.title && !item.name && item.profile_path)) {
                    const card = createCard(item.profile_path, item.name);
                    card.onclick = () => { history.pushState({modal: 'personPage'}, ""); openPersonDetails(item.id); };
                    container.appendChild(card);
                } 
                else if(item.poster_path) {
                    const card = createCard(item.poster_path, item.title || item.name);
                    card.onclick = () => { history.pushState({modal: 'detailPage'}, ""); openDetails(item.id, type); };
                    container.appendChild(card);
                }
            });
        }

        function createCard(path, text) {
            const div = document.createElement('div');
            div.className = "flex flex-col cursor-pointer active:scale-95 transition-transform";
            div.innerHTML = `<img src="https://image.tmdb.org/t/p/w300${path}" class="rounded-xl aspect-[2/3] object-cover shadow-lg border border-white/5"><div class="text-[7px] font-bold truncate mt-2 uppercase text-center text-gray-500 px-1">${text}</div>`;
            return div;
        }

        async function openDetails(id, type) {
            const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB_KEY}&language=tr-TR&append_to_response=credits`);
            const data = await res.json();
            currentTitle = data.title || data.name;
            document.getElementById('detailTitle').innerText = currentTitle;
            document.getElementById('detailPoster').src = `https://image.tmdb.org/t/p/w500${data.poster_path}`;
            const castDiv = document.getElementById('castList'); castDiv.innerHTML = "";
            if(data.credits && data.credits.cast) {
                data.credits.cast.slice(0, 15).forEach(p => {
                    const card = document.createElement('div'); card.className = "cast-card";
                    card.innerHTML = `<img src="https://image.tmdb.org/t/p/w185${p.profile_path || ''}" onerror="this.src='https://via.placeholder.com/150'"><div class="text-[7px] mt-1 truncate font-medium text-gray-500">${p.name}</div>`;
                    card.onclick = (e) => { e.stopPropagation(); history.pushState({modal: 'personPage'}, ""); openPersonDetails(p.id); };
                    castDiv.appendChild(card);
                });
            }
            document.getElementById('detailPage').classList.add('show-modal');
        }

        async function openPersonDetails(id) {
            const res = await fetch(`https://api.themoviedb.org/3/person/${id}?api_key=${TMDB_KEY}&language=tr-TR&append_to_response=combined_credits`);
            const data = await res.json();
            document.getElementById('personName').innerText = data.name;
            document.getElementById('personImg').src = `https://image.tmdb.org/t/p/w500${data.profile_path}`;
            personFullCredits = data.combined_credits.cast.filter(i => i.poster_path).sort((a,b) => b.vote_count - a.vote_count);
            personPageNum = 1; renderPersonCredits(false);
            document.getElementById('personPage').classList.add('show-modal');
        }

        function renderPersonCredits(append = false) {
            const start = (personPageNum - 1) * 16;
            const end = personPageNum * 16;
            displayItems(personFullCredits.slice(start, end), 'personCredits', append);
            const btn = document.getElementById('loadMorePerson');
            btn.style.display = end < personFullCredits.length ? 'block' : 'none';
            btn.onclick = () => { personPageNum++; renderPersonCredits(true); };
        }

        function showSources() {
            const list = document.getElementById('sourceList'); list.innerHTML = "";
            const cleanTitle = currentTitle.split('(')[0].trim();
            const query = encodeURIComponent(cleanTitle);
            const sourceMap = [
                { name: "EROGARGA", url: `https://www.erogarga.com/?s=${query}` },
                { name: "TUBE PORN CLASSIC", url: `https://tubepornclassic.com/search/1/?s=${query}` },
                { name: "XNXX", url: `https://www.xnxx.com/search/${query.replace(/%20/g, '+')}` },
                { name: "XHAMSTER", url: `https://xhamster.com/search?q=${query.replace(/%20/g, '+')}` },
                { name: "XVIDEOS", url: `https://www.xvideos.com/?k=${query.replace(/%20/g, '+')}` },
                { name: "NOODLE MAGAZINE", url: `https://noodlemagazine.com/video/${query.replace(/%20/g, '-')}` }
            ];
            sourceMap.forEach(src => {
                const btn = document.createElement('button');
                btn.className = "source-btn";
                btn.innerText = src.name;
                btn.onclick = () => window.open(src.url, '_blank');
                list.appendChild(btn);
            });
            document.getElementById('sourceModal').classList.add('show-modal');
        }

        window.onpopstate = function() {
            document.querySelectorAll('.full-modal').forEach(m => m.classList.remove('show-modal'));
        };
    </script>
</body>
</html>
