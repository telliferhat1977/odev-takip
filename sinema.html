<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SinemaTV DB - Detaylƒ± Mod</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --n-red: #E50914; --n-black: #141414; }
        body { background-color: var(--n-black); color: white; font-family: sans-serif; margin: 0; overflow-x: hidden; }
        .nav-item { transition: all 0.2s; border: 3px solid transparent; }
        .nav-item:focus { border-color: white; transform: scale(1.02); outline: none; background: #333; }
        .video-layer, .full-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; background: var(--n-black); overflow-y: auto; }
        .cast-chip:focus { background: var(--n-red); color: white; outline: none; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #444; }
    </style>
</head>
<body>

    <div id="mainUI" class="p-6 md:p-10">
        <header class="flex flex-col md:flex-row items-center justify-between mb-8 gap-4">
            <h1 class="text-3xl font-black text-[#E50914]">Sƒ∞NEMA<span class="text-white">TV</span></h1>
            <div class="flex w-full md:w-auto gap-2">
                <input type="text" id="searchInput" placeholder="Film, Dizi veya Oyuncu..." class="bg-[#222] p-4 flex-1 md:w-64 rounded-xl outline-none focus:bg-[#333]">
                <button onclick="searchContent()" class="nav-item bg-[#E50914] px-6 py-4 rounded-xl font-bold uppercase">ARA</button>
            </div>
        </header>
        <div id="results" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 md:gap-6"></div>
    </div>

    <div id="detailPage" class="full-modal p-6 md:p-20">
        <button onclick="closeDetail()" class="nav-item mb-6 bg-white/10 px-6 py-2 rounded-full font-bold uppercase text-xs">‚Üê GERƒ∞</button>
        <div class="flex flex-col md:flex-row gap-10">
            <img id="detailPoster" class="w-full md:w-80 rounded-2xl shadow-2xl border border-gray-800">
            <div class="flex-1">
                <h2 id="detailTitle" class="text-4xl md:text-6xl font-black mb-4"></h2>
                <div class="flex items-center gap-4 mb-6">
                    <span id="detailRating" class="bg-yellow-500 text-black px-3 py-1 rounded-md font-bold text-sm"></span>
                    <span id="detailYear" class="text-gray-400"></span>
                </div>
                <p id="detailOverview" class="text-gray-300 text-lg leading-relaxed mb-8 max-w-2xl"></p>
                
                <h3 class="text-xl font-bold mb-4 text-red-500 uppercase tracking-widest">Oyuncular</h3>
                <div id="detailCast" class="flex flex-wrap gap-2 mb-10"></div>

                <button onclick="openSourceMenu()" class="nav-item bg-[#E50914] w-full md:w-auto px-12 py-5 rounded-2xl font-black text-2xl shadow-xl hover:scale-105 active:scale-95 transition-all">
                    ‚ñ∂ Fƒ∞LMƒ∞ OYNAT
                </button>
            </div>
        </div>
    </div>

    <div id="sourceModal" class="full-modal bg-black/90 flex items-center justify-center p-10" style="z-index: 2000;">
        <div class="bg-[#1a1a1a] p-8 rounded-3xl border border-gray-700 w-full max-w-sm text-center">
            <h2 class="text-2xl font-bold mb-6 text-red-500">KAYNAK SE√áƒ∞N</h2>
            <div id="sourceButtons" class="flex flex-col gap-3">
                </div>
            <button onclick="closeSourceModal()" class="nav-item mt-6 text-gray-500 uppercase text-xs underline">Vazge√ß</button>
        </div>
    </div>

    <div id="videoLayer" class="video-layer flex flex-col" style="z-index: 3000;">
        <div class="p-4 bg-black flex justify-between items-center border-b border-white/10">
            <button onclick="closePlayer()" class="nav-item bg-white/10 px-6 py-2 rounded-full font-bold">‚Üê KAPAT</button>
            <button onclick="makeFullScreen()" class="nav-item bg-red-600 px-6 py-2 rounded-full font-bold">üì∫ TAM EKRAN</button>
        </div>
        <iframe id="playerFrame" src="" class="flex-1 w-full bg-black" allowfullscreen allow="autoplay"></iframe>
    </div>

    <script>
        const API_KEY = "847629da5649502fa6655f73b15a5c8e";
        let currentId, currentType, currentTitle, currentS = 1, currentE = 1;

        async function searchContent(queryOverride = null) {
            const query = queryOverride || document.getElementById('searchInput').value;
            if(!query) return;
            const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(query)}&language=tr-TR`);
            const data = await res.json();
            displayResults(data.results);
            closeDetail(); // Oyuncuya tƒ±klandƒ±ysa sayfayƒ± kapat
            window.scrollTo(0,0);
        }

        function displayResults(results) {
            const container = document.getElementById('results');
            container.innerHTML = "";
            results.forEach(item => {
                if(!item.poster_path && item.media_type !== 'person') return;
                const btn = document.createElement('button');
                btn.className = "nav-item rounded-2xl overflow-hidden bg-[#1a1a1a] text-left shadow-lg";
                const img = item.poster_path ? `https://image.tmdb.org/t/p/w500${item.poster_path}` : `https://image.tmdb.org/t/p/w500${item.profile_path}`;
                btn.innerHTML = `
                    <img src="${img}" class="w-full aspect-[2/3] object-cover">
                    <div class="p-3 text-[11px] font-bold truncate">${item.title || item.name}</div>
                `;
                btn.onclick = () => item.media_type === 'person' ? searchContent(item.name) : openDetails(item.id, item.media_type);
                container.appendChild(btn);
            });
        }

        async function openDetails(id, type) {
            currentId = id; currentType = type;
            const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}&language=tr-TR&append_to_response=credits`);
            const data = await res.json();
            
            document.getElementById('detailTitle').innerText = data.title || data.name;
            document.getElementById('detailOverview').innerText = data.overview || "Konu bulunamadƒ±.";
            document.getElementById('detailRating').innerText = "‚≠ê " + (data.vote_average ? data.vote_average.toFixed(1) : "N/A");
            document.getElementById('detailYear').innerText = (data.release_date || data.first_air_date || "").split('-')[0];
            document.getElementById('detailPoster').src = `https://image.tmdb.org/t/p/w500${data.poster_path}`;
            
            const castContainer = document.getElementById('detailCast');
            castContainer.innerHTML = "";
            data.credits.cast.slice(0, 10).forEach(actor => {
                const chip = document.createElement('button');
                chip.className = "cast-chip nav-item bg-[#333] px-4 py-2 rounded-full text-xs font-medium";
                chip.innerText = actor.name;
                chip.onclick = () => searchContent(actor.name);
                castContainer.appendChild(chip);
            });

            document.getElementById('detailPage').style.display = 'block';
        }

        function openSourceMenu() {
            if(currentType === 'tv') {
                const s = prompt("Sezon:", "1"); const e = prompt("B√∂l√ºm:", "1");
                if(s && e) { currentS = s; currentE = e; showSources(); }
            } else { showSources(); }
        }

        function showSources() {
            const container = document.getElementById('sourceButtons');
            container.innerHTML = "";
            const sources = [
                {id: 'vidlink', name: 'KAYNAK 1 (HIZLI)'},
                {id: 'vidsrc_to', name: 'KAYNAK 2 (GENƒ∞≈û)'},
                {id: 'vidsrc_me', name: 'KAYNAK 3 (STABƒ∞L)'}
            ];
            sources.forEach(src => {
                const b = document.createElement('button');
                b.className = "nav-item bg-red-700/20 border border-red-900 p-4 rounded-xl font-bold uppercase";
                b.innerText = src.name;
                b.onclick = () => playVideo(src.id);
                container.appendChild(b);
            });
            document.getElementById('sourceModal').style.display = 'flex';
        }

        function playVideo(provider) {
            let url = "";
            if(provider === 'vidlink') url = currentType === 'tv' ? `https://vidlink.pro/tv/${currentId}/${currentS}/${currentE}` : `https://vidlink.pro/movie/${currentId}`;
            if(provider === 'vidsrc_to') url = currentType === 'tv' ? `https://vidsrc.to/embed/tv/${currentId}/${currentS}/${currentE}` : `https://vidsrc.to/embed/movie/${currentId}`;
            if(provider === 'vidsrc_me') url = currentType === 'tv' ? `https://vidsrc.me/embed/tv?tmdb=${currentId}&sea=${currentS}&epi=${currentE}` : `https://vidsrc.me/embed/movie?tmdb=${currentId}`;
            
            document.getElementById('playerFrame').src = url;
            document.getElementById('videoLayer').style.display = 'flex';
        }

        function makeFullScreen() {
            const f = document.getElementById('playerFrame');
            if(f.requestFullscreen) f.requestFullscreen(); else if(f.webkitRequestFullscreen) f.webkitRequestFullscreen();
        }

        function closeDetail() { document.getElementById('detailPage').style.display = 'none'; }
        function closeSourceModal() { document.getElementById('sourceModal').style.display = 'none'; }
        function closePlayer() { document.getElementById('playerFrame').src = ""; document.getElementById('videoLayer').style.display = 'none'; }
        document.getElementById("searchInput").addEventListener("keypress", (e) => { if (e.key === "Enter") searchContent(); });
    </script>
</body>
</html>
