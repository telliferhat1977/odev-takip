<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SinemaTV Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --n-red: #E50914; --n-black: #141414; }
        body { background-color: var(--n-black); color: white; font-family: sans-serif; overflow-x: hidden; }
        .nav-item { transition: all 0.2s; border: 3px solid transparent; }
        .nav-item:focus { border-color: white; transform: scale(1.05); outline: none; background: #333; }
        .video-layer { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; background: black; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 500; align-items: center; justify-content: center; padding: 20px; }
        .ep-item:focus { border-left: 8px solid var(--n-red); background: #222; outline: none; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="p-6 md:p-10">

    <div id="mainUI">
        <header class="flex flex-col md:flex-row items-center justify-between mb-10 gap-4">
            <h1 class="text-4xl font-black text-[#E50914] tracking-tighter">SİNEMA<span class="text-white">TV</span></h1>
            <div class="flex w-full md:w-auto gap-2">
                <input type="text" id="searchInput" placeholder="Film veya Dizi..." 
                       class="bg-[#333] p-4 flex-1 md:w-80 rounded-md text-lg outline-none">
                <button onclick="searchContent()" class="nav-item bg-[#E50914] px-8 py-4 rounded-md font-bold">ARA</button>
            </div>
        </header>
        <div id="results" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-6"></div>
    </div>

    <div id="episodeModal" class="modal">
        <div class="bg-[#181818] w-full max-w-2xl max-h-[85vh] rounded-2xl p-6 flex flex-col border border-gray-800">
            <h2 id="modalTitle" class="text-2xl font-bold mb-6 text-red-500">Seçim Yapın</h2>
            <div id="episodeList" class="flex-1 overflow-y-auto space-y-2 pr-2"></div>
            <button onclick="closeModal()" class="nav-item mt-4 bg-gray-800 p-4 rounded-xl">KAPAT</button>
        </div>
    </div>

    <div id="sourceModal" class="modal">
        <div class="bg-[#1a1a1a] p-8 rounded-3xl border border-gray-700 w-full max-w-sm text-center">
            <h2 class="text-2xl font-bold mb-6 text-red-500 text-center">Yayın Kaynağı</h2>
            <div class="flex flex-col gap-3">
                <button onclick="finalPlay('vidlink')" class="nav-item bg-blue-600 p-4 rounded-xl font-bold">KAYNAK 1 (HIZLI)</button>
                <button onclick="finalPlay('vidsrc_to')" class="nav-item bg-red-700 p-4 rounded-xl font-bold">KAYNAK 2 (GENİŞ)</button>
                <button onclick="finalPlay('vidsrc_me')" class="nav-item bg-indigo-700 p-4 rounded-xl font-bold">KAYNAK 3 (STABİL)</button>
                <button onclick="finalPlay('superembed')" class="nav-item bg-orange-700 p-4 rounded-xl font-bold">KAYNAK 4 (ALTERNATİF)</button>
                <button onclick="closeSourceModal()" class="nav-item bg-gray-700 p-3 rounded-xl mt-2 text-sm">VAZGEÇ</button>
            </div>
        </div>
    </div>

    <div id="videoLayer" class="video-layer">
        <div class="absolute top-0 left-0 w-full p-4 flex justify-between items-center z-[1100] bg-gradient-to-b from-black/90 to-transparent">
            <button onclick="closePlayer()" class="nav-item bg-white/10 backdrop-blur-md px-6 py-2 rounded-full font-bold">← GERİ</button>
            <span id="playingTitle" class="text-gray-400 text-sm italic"></span>
        </div>
        <iframe id="playerFrame" src="" class="w-full h-full" frameborder="0" allowfullscreen></iframe>
    </div>

    <script>
        const API_KEY = "847629da5649502fa6655f73b15a5c8e";
        let currentId, currentType, currentTitle, currentS, currentE;

        async function searchContent() {
            const query = document.getElementById('searchInput').value;
            if(!query) return;
            const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(query)}&language=tr-TR`);
            const data = await res.json();
            const container = document.getElementById('results');
            container.innerHTML = "";
            data.results.forEach(item => {
                if(!item.poster_path || item.media_type === 'person') return;
                const btn = document.createElement('button');
                btn.className = "nav-item rounded-lg overflow-hidden bg-[#222] text-left";
                btn.innerHTML = `<img src="https://image.tmdb.org/t/p/w500${item.poster_path}" class="w-full"><div class="p-2 text-xs font-bold truncate">${item.title || item.name}</div>`;
                btn.onclick = () => {
                    currentId = item.id;
                    currentType = item.media_type;
                    currentTitle = item.title || item.name;
                    if(currentType === 'tv') loadSeasons(); else openSourceMenu();
                };
                container.appendChild(btn);
            });
        }

        async function loadSeasons() {
            const res = await fetch(`https://api.themoviedb.org/3/tv/${currentId}?api_key=${API_KEY}&language=tr-TR`);
            const data = await res.json();
            const list = document.getElementById('episodeList');
            list.innerHTML = "";
            document.getElementById('modalTitle').innerText = "Sezon Seçin";
            data.seasons.forEach(s => {
                if(s.season_number === 0) return;
                const btn = document.createElement('button');
                btn.className = "ep-item w-full text-left p-4 bg-[#262626] rounded mb-2 nav-item font-bold";
                btn.innerText = `${s.name} (${s.episode_count} Bölüm)`;
                btn.onclick = () => loadEpisodes(s.season_number);
                list.appendChild(btn);
            });
            document.getElementById('episodeModal').style.display = 'flex';
            list.firstChild?.focus();
        }

        async function loadEpisodes(sNum) {
            currentS = sNum;
            const res = await fetch(`https://api.themoviedb.org/3/tv/${currentId}/season/${sNum}?api_key=${API_KEY}&language=tr-TR`);
            const data = await res.json();
            const list = document.getElementById('episodeList');
            list.innerHTML = "";
            document.getElementById('modalTitle').innerText = `${sNum}. Sezon Bölümleri`;
            data.episodes.forEach(ep => {
                const btn = document.createElement('button');
                btn.className = "ep-item w-full text-left p-4 bg-[#262626] rounded mb-2 nav-item";
                btn.innerText = `${ep.episode_number}. ${ep.name}`;
                btn.onclick = () => { currentE = ep.episode_number; openSourceMenu(); };
                list.appendChild(btn);
            });
            list.firstChild?.focus();
        }

        function openSourceMenu() {
            document.getElementById('sourceModal').style.display = 'flex';
            document.querySelector('#sourceModal button').focus();
        }

        function finalPlay(provider) {
            let url = "";
            const isTV = (currentType === 'tv');
            if(provider === 'vidlink') url = isTV ? `https://vidlink.pro/tv/${currentId}/${currentS}/${currentE}` : `https://vidlink.pro/movie/${currentId}`;
            if(provider === 'vidsrc_to') url = isTV ? `https://vidsrc.to/embed/tv/${currentId}/${currentS}/${currentE}` : `https://vidsrc.to/embed/movie/${currentId}`;
            if(provider === 'vidsrc_me') url = isTV ? `https://vidsrc.me/embed/tv?tmdb=${currentId}&sea=${currentS}&epi=${currentE}` : `https://vidsrc.me/embed/movie?tmdb=${currentId}`;
            if(provider === 'superembed') url = isTV ? `https://multiembed.mov/directstream.php?video_id=${currentId}&tmdb=1&s=${currentS}&e=${currentE}` : `https://multiembed.mov/directstream.php?video_id=${currentId}&tmdb=1`;
            
            document.getElementById('playingTitle').innerText = currentTitle + (isTV ? ` - S${currentS}E${currentE}` : "");
            document.getElementById('playerFrame').src = url;
            document.getElementById('videoLayer').style.display = 'block';
            closeSourceModal();
            closeModal();
        }

        function closeSourceModal() { document.getElementById('sourceModal').style.display = 'none'; }
        function closeModal() { document.getElementById('episodeModal').style.display = 'none'; }
        function closePlayer() { document.getElementById('playerFrame').src = ""; document.getElementById('videoLayer').style.display = 'none'; }

        document.getElementById("searchInput").addEventListener("keypress", (e) => { if (e.key === "Enter") searchContent(); });
    </script>
</body>
</html>
